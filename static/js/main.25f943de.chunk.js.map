{"version":3,"sources":["auth-provider.ts","utils/http.ts","utils/index.ts","utils/use-async.ts","components/lib.tsx","context/auth-context.tsx","utils/user.ts","components/id-select.tsx","components/user-select.tsx","screens/project-list/search-panel.tsx","components/pin.tsx","utils/reorder.ts","utils/use-optimistic-options.ts","utils/project.ts","utils/url.ts","screens/project-list/util.ts","screens/project-list/list.tsx","screens/project-list/index.tsx","assets/software-logo.svg","components/drag-and-drop.tsx","utils/kanban.ts","utils/task.ts","utils/task-type.ts","screens/kanban/util.ts","assets/task.svg","assets/bug.svg","screens/kanban/create-task.tsx","components/mark.tsx","screens/kanban/kanban-column.tsx","screens/kanban/create-kanban.tsx","components/task-type-select.tsx","screens/kanban/search-panel.tsx","screens/kanban/task-modal.tsx","screens/kanban/index.tsx","screens/epic/util.ts","screens/epic/create-epic.tsx","utils/epic.ts","screens/epic/index.tsx","screens/project/index.tsx","screens/project-list/project-modal.tsx","components/project-popover.tsx","components/user-popover.tsx","authenticated-app.tsx","unauthenticated-app/login.tsx","unauthenticated-app/register.tsx","assets/logo.svg","assets/left.svg","assets/right.svg","unauthenticated-app/index.tsx","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx"],"names":["localStorageKey","apiUrl","process","handleUserResponse","user","window","localStorage","setItem","token","logout","a","removeItem","http","endpoint","data","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","body","JSON","fetch","then","response","status","auth","location","reload","Promise","reject","message","json","ok","useHttp","useAuth","useCallback","useDocumentTitle","title","keepOnUnmount","oldTitle","useRef","document","current","useEffect","resetRoute","href","origin","defaultIintialState","stat","error","defaultConfig","throwOnError","useSafeDispatch","dispatch","mounteRef","mountedRef","useMounteRef","useAsync","initialState","initialConfig","useReducer","state","action","safeDispatch","useState","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isIdle","isLoading","isSuccess","isError","Row","styled","div","props","between","undefined","marginBottom","gap","FullPage","FullPageLoading","size","FullyPageErrorFallBack","ErrorBox","value","Text","type","ButtonNoPadding","Button","ScreenContainer","bootstrapUser","getItem","AuthContext","createContext","displayName","AuthProvider","callback","children","setUser","queryClient","useQueryClient","Provider","login","form","register","clear","context","useContext","useUsers","param","client","useQuery","IdSelect","onChange","defaultOptionName","options","restProps","length","toNumber","Option","map","option","id","name","isNaN","Number","UserSelect","users","SearchPanel","setParam","style","layout","Item","placeholder","evt","target","personId","Pin","checked","onCheckedChange","count","num","reorder","fromId","referenceId","list","copiedList","movingItemIndex","findIndex","item","insertAfter","targetIndex","insertBefore","from","to","toItem","removedItem","splice","toIndex","indexOf","useConfig","queryKey","callBack","onSuccess","invalidateQueries","onMutate","previousItems","getQueryData","setQueryData","old","onError","newItem","useDeleteConfig","filter","useEditConfig","useAddConfig","useProjects","useEditProject","useMutation","params","useAddProject","useProject","enabled","useUrlQueryParam","keys","useSearchParams","searchParams","setUrlSearchParams","useSetUrlSearchParam","useMemo","reduce","prev","key","get","setSearchParam","o","object","result","Object","forEach","clearnObject","fromEntries","useProjectSearchParams","useProjectQueryKey","useProjectModal","projectCreate","setProjectCreate","editingProjectId","setEditingProjectId","setUrlParams","projectModalOpen","open","close","startEdit","editingProject","List","mutate","rowKey","pagination","columns","disabled","render","project","pin","sorter","b","localeCompare","String","dataIndex","find","created","dayjs","format","More","deleteProject","useDeleteProject","overlay","onClick","Modal","confirm","content","okText","onOk","confirmDeleteProject","ProjectListScreen","delay","debouncedValue","setDebouncedValue","timeout","setTimeout","clearTimeout","useDebounce","console","log","loading","dataSource","whyDidYouRender","_defs","_g","Drop","provided","isValidElement","cloneElement","droppableProps","ref","innerRef","DropChild","forwardRef","Drag","draggableProps","dragHandleProps","useKanbans","useReorderKanban","useReorderKanbanConfig","useTasks","useReorderTask","kanbanId","toKanbanId","useReorderTaskConfig","useTaskTypes","useProjectIdInUrl","useLocation","pathname","match","useProjectInUrl","useKanbanSearchParams","projectId","useKanbansQueryKey","useTasksSearchParams","typeId","processorId","tagId","useTasksQueryKey","useTasksModal","editingTaskId","setEditingTaskId","useTask","editingTask","CreateTask","setName","addTask","useAddTask","mutateAsync","inputMode","setInputMode","submit","toggle","mode","onBlur","autoFocus","onPressEnter","Mark","keyword","arr","split","str","index","color","TaskTypeIcon","taskTypes","task","alt","src","taskicon","bugicon","TaskCard","cursor","KanbanColumn","kanban","allTasks","tasks","Container","TasksContainer","direction","droppableId","minHeight","taskIndex","draggableId","useDeleteKanban","cancelText","CreateKanban","addKanban","useAddKanban","TaskTypeSelect","serachParams","setSearchParams","width","labelCol","span","wrapperCol","TaskModal","useForm","useEditTask","editTask","editLoading","deleteTask","useDeleteTask","getFieldsValue","setFieldsValue","forceRender","onCancel","resetFields","confirmLoading","visible","initialValues","label","rules","required","textAlign","fontSize","KanbanScreen","currentProject","kanbans","KanbanIsLoading","onDragEnd","useDragEnd","ColumnsContainer","display","reorderKanban","reorderTask","source","destination","toId","fromKanbanId","fromTask","toTask","useEpicSearchParams","useEpicsQueryKey","CreateEpic","useAddEpic","addEpic","onFinish","values","onClose","destroyOnClose","htmlType","EpicScreen","epics","useEpics","deleteEpic","useDeleteEpic","createEpicOpen","setCreateEpicOpen","overflow","itemLayout","renderItem","epic","Meta","confirmDeleteEpic","description","start","end","epicId","ProjectScreen","routeType","units","useRouteType","Aside","selectedKeys","Main","path","element","replace","aside","_extends","assign","i","arguments","prototype","hasOwnProperty","call","apply","this","_objectWithoutProperties","excluded","sourceKeys","_objectWithoutPropertiesLoose","getOwnPropertySymbols","sourceSymbolKeys","propertyIsEnumerable","SvgSoftwareLogo","_ref","svgRef","titleId","viewBox","xmlns","focusable","className","x1","y1","x2","y2","stopColor","offset","stroke","strokeWidth","fillRule","d","fill","ForwardRef","ProjectModal","mutateLoading","ProjectPopover","projects","refetch","pinnedProjects","ContentContainer","onVisibleChange","placement","UserPopover","AuthenticatedApp","PageHader","Header","HeaderLeft","HeaderRight","User","e","preventDefault","main","LoginScreen","handleSubmit","LongButton","RegisterScreen","cpassword","password","UnauthenticatedApp","isRegister","setIsRegister","Background","ShadowCard","Title","h2","left","right","header","logo","Card","ErrorBoundary","fallbackRender","Component","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AppProviders","QueryClient","loadServer","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.25f943de.chunk.js","sourcesContent":["import { User } from \"types/User\";\r\n\r\nconst localStorageKey = '__auth_provider_token__';\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\nexport const getToken = () => window.localStorage.getItem(localStorageKey)\r\n\r\nexport const handleUserResponse = ({user}: {user: User}) => {\r\n   window.localStorage.setItem(localStorageKey, user.token || '')\r\n   return user\r\n}\r\n\r\n\r\nexport const login = (data: {username:string, password:string}) => {\r\nreturn fetch(`${apiUrl}/login`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(data)\r\n      }).then(async (response) => {\r\n        if (response.ok) {\r\n          return handleUserResponse(await response.json())\r\n        } else {\r\n          return Promise.reject(await response.json())\r\n          //return Promise.reject(data)\r\n        }\r\n      });\r\n}\r\n\r\nexport const register = (data: {username:string, password:string}) => {\r\nreturn fetch(`${apiUrl}/register`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(data)\r\n      }).then(async (response) => {\r\n        if (response.ok) {\r\n            return handleUserResponse(await response.json())\r\n        } else {\r\n          return Promise.reject(await response.json())\r\n         // return Promise.reject(data)\r\n        }\r\n      });\r\n}\r\n\r\nexport const  logout = async () => window.localStorage.removeItem(localStorageKey)","import  qs from \"qs\";\r\nimport * as auth from \"auth-provider\";\r\nimport { useAuth } from \"context/auth-context\";\r\nimport { useCallback } from \"react\";\r\n// import { type } from \"os\";\r\n// import { useArray } from \"utils\";\r\n// import { config } from \"process\";\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL;\r\n\r\ninterface Config extends RequestInit {\r\n    token?: string,\r\n    data?: object;\r\n}\r\n\r\n//...customConfig 後面的值會覆蓋前面的,所以method: 'GET'不會寫死,也有可能是method: 'POST' 或method: 'PUT'....等\r\n// export const http = async (endpoint:string,{data, token, headers, ...customConfig}:RequestInit) => {\r\nexport const http = async (endpoint:string, {data, token, headers, ...customConfig}: Config = {}) => {\r\n    const config = {\r\n        method: 'GET',\r\n        headers: {\r\n            Authorization: token ? `Bearer ${token}` : '',\r\n            'Content-Type': data ? 'application/json' : ''\r\n        },\r\n        ...customConfig\r\n    }\r\n    //GET 可參考 D:\\720s\\React\\jira\\src\\screens\\project-list\\index.tsx\r\n    //POST 可參考 D:\\720s\\React\\jira\\src\\auth-provider.ts\r\n    if (config.method.toUpperCase() === 'GET') {\r\n        endpoint += `?${qs.stringify(data)}`\r\n    } else {\r\n       config.body = JSON.stringify(data || {});\r\n    }\r\n\r\n  //POST = 新增; GET = 讀取; PUT = 更新; DELETE = 刪除\r\n  //fetch見5-7 11:00 ,fetch 用.catch()是抓不到服務端回傳的異常狀態,例如response.status === 401 或 500,只有斷網才抓的到\r\n  //但用 else 即 response不OK時是可以抓到服務端回傳的異常狀態401 或 500...等\r\n  //axios 和 fetch 不一樣,axios可以再返回狀態不為2XX時,拋出異常\r\n  return window.fetch(`${apiUrl}/${endpoint}`, config)\r\n         .then(async (response) => {\r\n             if (response.status === 401) {\r\n                //401 未登入或token失效\r\n                await auth.logout();\r\n                window.location.reload();\r\n                return Promise.reject({message: '請重新登入'});\r\n             }\r\n             const data = await response.json();\r\n             if (response.ok) {\r\n                 return data\r\n             } else {\r\n                return Promise.reject(data);\r\n             }\r\n         })\r\n}\r\n\r\n//// JS 中的typeof，是在runtime时运行的\r\n// return typeof 1 === 'number'\r\n// TS 中的typeof，是在静态环境运行的\r\n// Parameters<typeof http> 讀取http函式參數(Parameters)的類型\r\nexport const useHttp = () => {\r\n    const { user } = useAuth();\r\n    //Parameters,Omit,Partial.... 是 Utility Types 充當工具的類型\r\n   return useCallback((...[endpoint, config]: Parameters<typeof http>) => http(endpoint, {...config, token: user?.token}),[user?.token]);\r\n   //return (...[endpoint, config]: [string, Config]) => http(endpoint,{...config, token: user?.token})\r\n}\r\n\r\n//聯合類型\r\n// let myFavoriteNumber: string | number ;\r\n// myFavoriteNumber = 'aaaa';\r\n// myFavoriteNumber = 7 ;\r\n// myFavoriteNumber = {} 不可給對象,只能給 string | number\r\n\r\n// let jackFavoriteNumber: string | number 這樣寫麻煩將string | number 抽象出來新的類型,\r\n//改成類型別名,以下:\r\n//類型別名\r\n// type FavoriteNumber = string | number\r\n\r\n//   let jackFavoriteNumber: FavoriteNumber = 'aaaa' ;\r\n\r\n//類型別名類似interface在很多情况下可以互换\r\n// interface Person {\r\n//    name: string\r\n// }\r\n//也可改成\r\n// type Person = {name: string}\r\n// const person1 : Person = {name:'aaaa'}\r\n\r\n//差異 ,interface 在類型別名為聯合類型,这种情况下没法替代type\r\n// type FavoriteNumber1 = string | number\r\n// let jackFavoriteNumber1: FavoriteNumber1 = 'aaaa' ;\r\n\r\n//差異 interface 也没法实现Utility type\r\n// type Person = {\r\n//     name: string;\r\n//     age: number;\r\n//   };\r\n//  const xiaoMing: Partial<Person> = {}; //允許Person部分屬性\r\n  \r\n//  // const shenMiRen: Omit<Person, \"name\"  > = {name: ''}; //排除不需要Person的屬性\r\n//   const shenMiRen1: Omit<Person, \"name\" | \"age\" > = {}; //排除不需要Person的屬性,但屬性全部排除,剩{},又變成全都可以\r\n//   type PersonKeys = keyof Person;\r\n//   type PersonOnlyName = Pick<Person, \"name\" | \"age\">; //在Person中挑選一些類型組成新的類型\r\n//   type Age = Exclude<PersonKeys, \"name\">;\r\n  \r\n  // Partial 的实现,例如: type PersonKeys = keyof Person; 代表取出Person內的鍵值name和age,\r\n  // 這邊的T就 代表Person ,keyof T就代表所有鍵值的集合,p in表示遍歷所有鍵值,重點是? 可以所有鍵值或少1或2個鍵值或空對象...\r\n  //  T[P]及取得值 例如: Person['age']或Person['age','name']的意思\r\n//   type Partial<T> = {\r\n//     [P in keyof T]?: T[P];\r\n//   };\r\n\r\n  //keyof T 就代表所有鍵值的集合,K extends ,K是使用者給的鍵值子集,必須在所有鍵值的集合內\r\n  //(extends)可想成繼承,k的集合可以小於等於所有鍵值的集合(keyof T)\r\n  //P遍歷所有子集, T[P]取得所有子集的值,可看範例PersonOnlyName\r\n//   type Pick<T, K extends keyof T> = {\r\n//     [P in K]: T[P];\r\n// };\r\n\r\n//T的集合一定大於U,正常來說T繼承至U一定要小於等於U,但因有比較運算?,\r\n//所以T的集合可以大於U,又U集合的對象在T集合也有,則會給never,否則保留在T集合內\r\n// type Exclude<T, U> = T extends U ? never : T;","import { useEffect, useRef, useState } from \"react\"\r\n\r\nexport const isFalsy = (value: unknown) => value === 0 ? false : !value\r\nexport const isVoid = (value: unknown) => value === undefined ||  value === null ||  value === \"\"\r\n\r\n// let c: object\r\n// c = {name: 'jack'}\r\n// c= () => {}\r\n// c= new RegExp('')\r\n// const c= {...(()=>{}) } 當let c: object這樣解構任何東西都是空數組,無意義的,因為object的範圍太大\r\n// let b: {[key: string]: unknown}\r\n// b = {name: 'jack'}\r\n// b= () => {}\r\n//在一個函數裡,改變傳入的對象是不好的,在這裡把它copy一份給result\r\nexport const clearnObject = (object: {[key: string]: unknown}) => {\r\n   // Object.assign({},object)\r\n    const result = {...object}\r\n    Object.keys(result).forEach(key => {\r\n        // value= 0 時也會delete .但他是有效數字,我們不想刪除\r\n        const value = result[key]\r\n        if (isVoid(value)) {          \r\n          delete result[key]\r\n        }\r\n    })\r\n  return result\r\n}\r\n\r\n\r\nexport const useMount = (callback: () => void ) => {\r\n  useEffect(() =>{\r\n    callback()\r\n    // TODO 依赖项里加上callback会造成无限循环，这个和useCallback以及useMemo有关系\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  },[]) //空數組是表示只在頁面加載時執行一次(或表示組件加載時只執行一次),\r\n        //*****空數組這邊如果改加callback,會造成封包request一直送\r\n}\r\n//hook要加use,且只能在其他hook中或組件中運行\r\n\r\nexport const useDebounce = <T>(value: T,delay?: number) => {\r\n  //useState 表示響應式的,當值改變時能檢測到值改變,例如:頁面改變或useEffect改變可觸發useState\r\n  const [debouncedValue,setDebouncedValue] = useState(value)\r\n  \r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => setDebouncedValue(value),delay)\r\n    return () => clearTimeout(timeout)\r\n  },[value,delay])  //每次在value和delay改變時觸發useEffect\r\n  return debouncedValue\r\n}\r\n\r\n\r\n// const debounce = (func, delay) => {\r\n//   let timeout;\r\n//   return (...param) => {\r\n//     if (timeout) {\r\n//       clearTimeout(timeout);\r\n//     }\r\n//     timeout = setTimeout(function() {\r\n//       func(...param);\r\n//     }, delay);\r\n//   }\r\n// }\r\n// const log = debounce(() => console.log('call'), 5000)\r\n// log()\r\n// log()\r\n// log()\r\n//   ...5s\r\n// 执行！\r\n\r\n// debounce 原理讲解：可看視頻3-4 8:00\r\n// 0s ---------> 1s ---------> 2s --------> ...\r\n//     一定要理解：这三个函数都是同步操作，所以它们都是在 0~1s 这个时间段内瞬间完成的；\r\n//     log()#1 // timeout#1\r\n//     log()#2 // 发现 timeout#1！取消之，然后设置timeout#2\r\n//     log()#3 // 发现 timeout#2! 取消之，然后设置timeout#3\r\n//             // 所以，log()#3 结束后，就只剩timeout#3在独自等待了\r\n\r\nexport const useArray = <T>(initialArray: T[]) => {\r\n  const [value, setValue] = useState(initialArray);\r\n  return {\r\n    value,\r\n    setValue,\r\n    add: (item: T) => setValue([...value, item]),\r\n    clear: () => setValue([]),\r\n    removeIndex: (index: number) => {\r\n      const copy = [...value];\r\n      copy.splice(index, 1);\r\n      setValue(copy);\r\n    },\r\n  };\r\n};\r\n\r\nexport const useDocumentTitle = (title:string, keepOnUnmount:boolean = true) => {\r\n  const oldTitle = useRef(document.title).current; //讀取的值在hook生命週期內永遠不會變 \r\n  //const oldTitle = document.title\r\n  // 頁面加载时: 舊title 'React App'\r\n  // 加载后：新title\r\n\r\n\r\n // console.log('render時oldTitle',oldTitle)\r\n  useEffect(() => {\r\n      document.title = title \r\n  },[title])\r\n  \r\n   //重要當useEffect 後面是[] 時代表頁面卸載時觸發,例如切換其他頁面或reflesh\r\n   //但若[title]時表示title改變時觸發\r\n  useEffect(() => {\r\n      return () => { \r\n        if (!keepOnUnmount) {\r\n        //  console.log('unmount時oldTitle',oldTitle)\r\n\r\n       // 如果不指定依赖[]，讀到的永遠是舊title,因為一個function包含另一個function,外層function有const(oldTitle)或let,\r\n       //內層functionu有用到時要注意(閉包),永遠只讀到第一次的const(oldTitle)值,可看test範例\r\n      document.title = oldTitle \r\n    }\r\n  }} ,[keepOnUnmount,oldTitle])\r\n}\r\n\r\n//返回組件的掛載狀態,如果還沒掛載或已經卸載返回false,否則為true\r\nexport const useMounteRef = () => {\r\n  //useRef 會記錄mountedRef這個變數,預設值給false,mountedRef.current代表這個變數目前的值\r\n  //可參考https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/react-optimize-performance-using-memo-usecallback-usememo-a76b6b272df3\r\n   const  mountedRef = useRef(false)  \r\n   //useEffect 在頁面加載後被調用 mountedRef.current = true ,卸載後才會return mountedRef.current = false\r\n   useEffect(() => {\r\n    mountedRef.current = true\r\n    return () => {\r\n      mountedRef.current = false\r\n    }\r\n   })\r\n\r\n   return mountedRef\r\n}\r\n\r\nexport const resetRoute = () => window.location.href= window.location.origin\r\n\r\n\r\n","import { useMounteRef } from './index';\r\nimport { useCallback, useReducer, useState } from \"react\"\r\n\r\n\r\ninterface State<D> {\r\n    error: Error | null,\r\n    data: D | null,\r\n    stat: 'idle' | 'loading' | 'error' | 'success'\r\n}\r\n\r\nconst defaultIintialState: State<null> = {\r\n    stat: 'idle',\r\n    data: null,\r\n    error: null\r\n}\r\n\r\nconst defaultConfig = {\r\n    throwOnError: false\r\n}\r\n\r\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\r\n   const mounteRef =  useMounteRef()\r\n   return useCallback((...args: T[]) => (mounteRef.current? dispatch(...args):void 0),[dispatch, mounteRef])\r\n}                   \r\n\r\nexport const useAsync = <D>(initialState?: State<D>, initialConfig?: typeof defaultConfig) => {\r\n    \r\n    \r\n    //解釋當你setState時,即是對initialState給值,例如:我只給data和stat,\r\n    //...initialState解構後為{stat: 'success', data: D} 只有2個元素,\r\n    //還少1個error元素,這時透過解構...defaultIintialState,會預帶{error: null}\r\n    //所以最後...defaultIintialState解構後為{stat: 'success', data: D, error: null} \r\n    const config = {...defaultConfig, ...initialConfig}\r\n    // const [state, setState] = useState<State<D>> ({\r\n    //      ...defaultIintialState,\r\n    //      ...initialState\r\n    // })\r\n    //當多個會互相影響的狀態用useReducer ,單個狀態用useState 見10-5 14:00 \r\n    const [state, dispatch] = useReducer((state: State<D>, action: Partial<State<D>> ) => ({...state, ...action}) , {\r\n        ...defaultIintialState,\r\n        ...initialState\r\n   })\r\n\r\n    // const mounteRef = useMounteRef()\r\n      const safeDispatch = useSafeDispatch(dispatch);\r\n\r\n    // useState直接传入函数的含意是：惰性初始化；所以，要用useState保存函数，不能直接传入函数\r\n    // https://codesandbox.io/s/blissful-water-230u4?file=/src/App.js\r\n    const [retry, setRetry] = useState(() => () => {});\r\n   // const [retry, setRetry] = useState(() => {});\r\n   // let retry = () => {} 這種寫法是錯誤的,因為每次渲染時retry變數都要重新定義一次,要用useState保留變數狀態\r\n    const setData = useCallback((data: D) => safeDispatch({\r\n       stat: 'success',\r\n       data,\r\n       error: null \r\n    }),[safeDispatch])\r\n\r\n    const setError =useCallback( (error: Error) => safeDispatch({\r\n       stat: 'error',\r\n       data: null,\r\n       error\r\n    }),[safeDispatch])\r\n\r\n    const run =useCallback((promise: Promise<D>, runConfig?: {retry: () => Promise<D> }) => {\r\n        if (!promise || !promise.then) {\r\n            throw new Error('請傳入 Promise 類型數據')\r\n        }\r\n       \r\n        //setRetry因為使用useState,會將函數保留下來() => run(promise) ,因此promise也會保留下來\r\n        setRetry(() => () => {\r\n            if (runConfig?.retry) {\r\n                run(runConfig?.retry(), runConfig)\r\n            }            \r\n          //  run(promise)\r\n        }); \r\n        //setState({...state, stat: 'loading'}) 改成以下\r\n       // dispatch(prevState => ({...prevState, stat: 'loading'})) \r\n       safeDispatch({stat: 'loading'}) \r\n        return promise.then((data) => {\r\n           // if (mounteRef.current) //組件被掛載,另組件也非卸載狀態\r\n              setData(data);\r\n            return data\r\n        }).catch((error) => {\r\n            //catch會攔截異常,導致更外層try catch時攔截不到異常\r\n            //例如:login.tsx 的handleSubmit 內的try catch時攔截不到異常,因此return error 改成\r\n           setError(error);\r\n           if (config.throwOnError) return Promise.reject(error);\r\n           return error;           \r\n        })\r\n   // },[config.throwOnError, mounteRef, setData, setError]) \r\n    },[config.throwOnError, setData, setError, safeDispatch]) \r\n\r\n    return {\r\n        isIdle: state.stat === 'idle',\r\n        isLoading: state.stat === 'loading',\r\n        isSuccess: state.stat === 'success',\r\n        isError: state.stat === 'error',\r\n        run,\r\n        setData,\r\n        setError,\r\n        // retry 被调用时重新跑一遍run，會觸發setState讓state刷新一遍,state刷新讓useAsync組件重跑一遍\r\n        retry,\r\n        ...state\r\n    }\r\n}","import styled from \"@emotion/styled\";\r\nimport { Button, Spin, Typography } from \"antd\";\r\nimport { DevTools } from \"jira-dev-tool\";\r\n\r\nexport const Row = styled.div<{\r\n  gap?: number | boolean;\r\n  between?: boolean;\r\n  marginBottom?: number;\r\n}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: ${(props) => (props.between ? \"space-between\" : undefined)};\r\n  margin-bottom: ${(props) => props.marginBottom + \"rem\"};\r\n  > * {\r\n    margin-top: 0 !important;\r\n    margin-bottom: 0 !important;\r\n    margin-right: ${(props) =>\r\n      typeof props.gap === \"number\"\r\n        ? props.gap + \"rem\"\r\n        : props.gap\r\n        ? \"2rem\"\r\n        : undefined};\r\n  }\r\n`;\r\n\r\nconst FullPage = styled.div`\r\nheight: 100vh;\r\ndisplay: flex;\r\njustify-content: center;\r\nalign-items: center;\r\n`\r\nexport const FullPageLoading = () => <FullPage>\r\n  <Spin size={\"large\"}></Spin>\r\n</FullPage>\r\n\r\nexport const FullyPageErrorFallBack = ({error}:{error: Error | null}) => <FullPage>\r\n <DevTools />\r\n{/* <Typography.Text type={'danger'}>{error?.message}</Typography.Text> */}\r\n<ErrorBox error = {error} />\r\n</FullPage>\r\n\r\n//此種方式可在undefine使用,不可在unknown上使用\r\n//export const ErrorBox = ({error} : {error?: {message: string} }) => {  \r\n // if (error?.message) {\r\n\r\n//另一種方式類型守衛, 當value?.message為true時 value is Error類型\r\nconst isError = (value: any): value is Error => value?.message\r\n\r\nexport const ErrorBox = ({error} : {error: unknown}) => {\r\n   if (isError(error)) {\r\n     return <Typography.Text type={'danger'}>{error?.message}</Typography.Text>\r\n   }\r\n   return null\r\n}\r\n\r\nexport const ButtonNoPadding =  styled(Button)`\r\n padding: 0 ;\r\n`\r\n\r\nexport const  ScreenContainer = styled.div`\r\npadding: 3.2rem;\r\nwidth: 100%;\r\ndisplay: flex;\r\nflex-direction: column;\r\n`;","import { createContext, ReactNode, useContext } from \"react\"; //, useState\r\nimport * as auth from \"auth-provider\";\r\nimport { User } from \"types/User\";\r\nimport { http } from \"utils/http\";\r\nimport { useMount } from \"utils\";\r\nimport { useAsync } from \"utils/use-async\";\r\nimport { FullPageLoading, FullyPageErrorFallBack } from \"components/lib\";\r\nimport { useQueryClient } from \"react-query\";\r\n\r\ninterface AuthForm {\r\n    username: string;\r\n    password: string;\r\n}\r\n\r\nconst bootstrapUser = async () => {\r\n    let user = null;\r\n    const token = auth.getToken();\r\n    if (token) {\r\n        const data = await http(\"me\", {token});\r\n        user = data.user;        \r\n    }\r\n    return user;\r\n}\r\n\r\n\r\nconst AuthContext = createContext<\r\n{\r\n user: User | null;\r\n login: (form: AuthForm) => Promise<void>;\r\n register: (form: AuthForm) => Promise<void>;\r\n logout: () => Promise<void>;\r\n} | undefined>(undefined);\r\n\r\nAuthContext.displayName = 'AuthContex';\r\n\r\n\r\n\r\n//頁面加載時會觸發\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n  // const [user, setUser] = useState<User | null>(null);\r\n   const {data: user, error, isLoading, isIdle, isError, run, setData: setUser } = useAsync<User | null>()\r\n   const queryClient = useQueryClient()\r\n                                            //user => setUser(user) 等於setUser 叫 point free\r\n   const login = (form: AuthForm) => auth.login(form).then(setUser);\r\n   const register = (form: AuthForm) => auth.register(form).then(setUser);\r\n   const logout = () => auth.logout().then(() => {\r\n      setUser(null)\r\n      queryClient.clear()\r\n    });\r\n\r\n   useMount(() => {\r\n    // bootstrapUser().then(setUser)\r\n     run(bootstrapUser())\r\n   });\r\n\r\n   if (isIdle || isLoading) \r\n   return <FullPageLoading/> \r\n\r\n   if (isError) \r\n   return <FullyPageErrorFallBack error={error}/>\r\n  \r\n   return (<AuthContext.Provider children={children} value={{user, login, register, logout}} />);\r\n}\r\n\r\nexport const useAuth = () => {\r\n    // console.log('useAuth')\r\n const context = useContext(AuthContext);\r\n if (!context) {\r\n     throw new Error('useAuth必需在AuthProvider中使用')\r\n }\r\n return context;\r\n}","import { useQuery } from \"react-query\";\r\nimport { User } from \"types/User\";\r\nimport { useHttp } from \"./http\";\r\n\r\n\r\nexport const useUsers = (param?: Partial<User>) => {\r\n    const client = useHttp();\r\n    return useQuery<User[]>(['users', param],() => client(\"users\", {data: param}))\r\n    // const {run, ...result} = useAsync<User[]>();\r\n     \r\n    // useEffect(() => {\r\n    //     run(client(\"users\", {data: clearnObject(param || {})}))\r\n    //     // eslint-disable-next-line\r\n    // },[param]); \r\n\r\n   // return result\r\n}\r\n\r\n","import { Select } from \"antd\";\r\nimport { ComponentProps } from \"react\";\r\nimport { Raw } from \"types\";\r\n\r\ntype Selectprops = ComponentProps<typeof Select>\r\n\r\ninterface IdSelectProps extends Omit<Selectprops,'value'|'onChange'|'options'> {\r\n    value?: Raw |null |undefined\r\n    onChange?: (value?:number) => void\r\n    defaultOptionName?: string\r\n    options?: {name: string, id: number}[]\r\n}\r\n\r\n/**\r\n * value 可以传入多种类型的值\r\n * onChange只会回调 number|undefined 类型\r\n * 当 isNaN(Number(value)) 为true的时候，代表选择默认类型\r\n * 当选择默认类型的时候，onChange会回调undefined\r\n */\r\nexport const IdSelect = (props: IdSelectProps) => {\r\n  const {value, onChange, defaultOptionName, options, ...restProps} = props;\r\n  return <Select \r\n            value={options?.length ? toNumber(value) : 0} \r\n            onChange={(value) => onChange?.(toNumber(value) || undefined)}\r\n            {...restProps}\r\n            >\r\n            {\r\n                defaultOptionName? <Select.Option value={0}>{defaultOptionName}</Select.Option> : null\r\n            }\r\n            {\r\n                options?.map(option => <Select.Option key={option.id} value={option.id}>{option.name}</Select.Option>)\r\n            }\r\n\r\n </Select>\r\n}\r\n\r\nconst toNumber = (value:unknown) => isNaN(Number(value))? 0 : Number(value); ","import { useUsers } from \"utils/user\";\r\nimport { IdSelect } from \"components/id-select\";\r\nimport { ComponentProps } from \"react\";\r\n\r\nexport const UserSelect = (props: ComponentProps<typeof IdSelect>) => {\r\n    \r\n    const { data: users} = useUsers();\r\n    \r\n    return <IdSelect options={users || []} {...props}/>\r\n}","import { Form, Input } from \"antd\";\r\nimport { Project } from \"../../types/Project\";\r\nimport { UserSelect } from \"components/user-select\";\r\nimport { User } from \"../../types/User\";\r\n\r\ninterface SearchPanelProps {\r\n  users: User[];\r\n  param: Partial<Pick<Project,'name' | 'personId'>>\r\n  // param: {\r\n  //   name: string;\r\n  //   personId: number;\r\n    \r\n  // };\r\n  setParam: (param: SearchPanelProps[\"param\"]) => void;\r\n}\r\n\r\nexport const SearchPanel = ({ users, param, setParam }: SearchPanelProps) => {\r\n  return (\r\n    <Form style={{ marginBottom: \"2rem\" }} layout={\"inline\"}>\r\n      <Form.Item>\r\n        {/*setParam(Object.assign({}, param, {name:evt.target.value}))*/}\r\n        <Input\r\n          placeholder={\"項目名\"}\r\n          type=\"text\"\r\n          value={param.name}\r\n          onChange={(evt) =>\r\n            setParam({\r\n              ...param,\r\n              name: evt.target.value,\r\n            })\r\n          }\r\n        />\r\n        </Form.Item>\r\n        <Form.Item>\r\n          <UserSelect \r\n           defaultOptionName ={'負責人'}\r\n           value={param.personId} onChange= {(value) =>\r\n            setParam({\r\n              ...param,\r\n              personId: value,\r\n            })}/>\r\n        {/* <Select\r\n          value={param.personId}\r\n          onChange={(value) =>\r\n            setParam({\r\n              ...param,\r\n              personId: value,\r\n            })\r\n          }\r\n        > */}\r\n        {/* <select\r\n          value={param.personId}\r\n          onChange={(evt) =>\r\n            setParam({\r\n              ...param,\r\n              personId: evt.target.value,\r\n            })\r\n          }\r\n        > */}\r\n          {/* <Select.Option value={\"\"}>负责人</Select.Option>\r\n          {users.map((user) => (\r\n            <Select.Option key={user.id} value={user.id}>\r\n              {user.name}\r\n            </Select.Option>\r\n          ))}\r\n        </Select> */}\r\n        </Form.Item>     \r\n    </Form>\r\n  );\r\n};","import { Rate } from \"antd\";\r\nimport { ComponentProps } from \"react\";\r\n\r\ninterface PinProps extends ComponentProps<typeof Rate> {\r\n    checked: boolean;\r\n    onCheckedChange?: (checked:boolean) => void\r\n}\r\n\r\nexport const Pin = ({checked, onCheckedChange, ...restProps}: PinProps) => {\r\n    return <Rate \r\n       count={1} \r\n       value = {checked? 1: 0}\r\n       onChange = {num => onCheckedChange?.(!!num)}\r\n       {...restProps}\r\n       />\r\n}","/**\r\n * 在本地对排序进行乐观更新\r\n * @param fromId 要排序的项目的id\r\n * @param type 'before' | 'after'\r\n * @param referenceId 参照id\r\n * @param list 要排序的列表, 比如tasks, kanbans\r\n */\r\n export const reorder = ({\r\n    fromId,\r\n    type,\r\n    referenceId,\r\n    list,\r\n  }: {\r\n    list: { id: number }[];\r\n    fromId: number;\r\n    type: \"after\" | \"before\";\r\n    referenceId: number;\r\n  }) => {\r\n    const copiedList = [...list];\r\n    // 找到fromId对应项目的下标\r\n    const movingItemIndex = copiedList.findIndex((item) => item.id === fromId);\r\n    if (!referenceId) {\r\n      return insertAfter([...copiedList], movingItemIndex, copiedList.length - 1);\r\n    }\r\n    const targetIndex = copiedList.findIndex((item) => item.id === referenceId);\r\n    const insert = type === \"after\" ? insertAfter : insertBefore;\r\n    return insert([...copiedList], movingItemIndex, targetIndex);\r\n  };\r\n  \r\n  /**\r\n   * 在list中，把from放在to的前边\r\n   * @param list\r\n   * @param from\r\n   * @param to\r\n   */\r\n  const insertBefore = (list: unknown[], from: number, to: number) => {\r\n    const toItem = list[to];\r\n    const removedItem = list.splice(from, 1)[0];\r\n    const toIndex = list.indexOf(toItem);\r\n    list.splice(toIndex, 0, removedItem);\r\n    return list;\r\n  };\r\n  \r\n  /**\r\n   * 在list中，把from放在to的后面\r\n   * @param list\r\n   * @param from\r\n   * @param to\r\n   */\r\n  const insertAfter = (list: unknown[], from: number, to: number) => {\r\n    const toItem = list[to];\r\n    const removedItem = list.splice(from, 1)[0];\r\n    const toIndex = list.indexOf(toItem);\r\n    list.splice(toIndex + 1, 0, removedItem);\r\n    return list;\r\n  };","import { QueryKey, useQueryClient } from \"react-query\";\r\nimport { Task } from \"types/task\";\r\nimport { reorder } from \"./reorder\";\r\n\r\nexport const useConfig = (\r\n    queryKey: QueryKey, \r\n    callBack: (target: any , old?: any[]) => any[]\r\n    ) => {\r\n    const queryClient = useQueryClient()\r\n    return {\r\n        onSuccess: () => queryClient.invalidateQueries(queryKey),\r\n        async onMutate(target: any) {         \r\n         const previousItems = queryClient.getQueryData(queryKey)\r\n         queryClient.setQueryData(queryKey,(old?: any[]) => {\r\n             return callBack(target, old) \r\n             //  return old?.map(project => project.id === target.id ? {...project, ...target} : project) || []\r\n         })\r\n         return {previousItems}\r\n        },        \r\n        onError(error: any, newItem: any, context: any) {\r\n          queryClient.setQueryData(queryKey,context.previousItems)\r\n        }\r\n    }\r\n\r\n}\r\n\r\nexport const useDeleteConfig = (queryKey: QueryKey) => useConfig(queryKey,(target, old) => old?.filter(item => item.id !== target.id)||[])\r\nexport const useEditConfig = (queryKey: QueryKey) => useConfig(queryKey,(target, old) => old?.map(item => item.id === target.id ? {...item,...target}:item)||[])\r\nexport const useAddConfig = (queryKey: QueryKey) => useConfig(queryKey,(target, old) => {\r\n                                                                               return old? [...old, target]:[target]})\r\n//export const useReorderConfig = (queryKey: QueryKey) => useConfig(queryKey,(target, old) => old || [])        \r\nexport const useReorderKanbanConfig = (queryKey: QueryKey) =>\r\n  useConfig(queryKey, (target, old) => reorder({ list: old, ...target }));\r\n\r\nexport const useReorderTaskConfig = (queryKey: QueryKey) =>\r\n  useConfig(queryKey, (target, old) => {\r\n    const orderedList = reorder({ list: old, ...target }) as Task[];\r\n    return orderedList.map((item) =>\r\n      item.id === target.fromId\r\n        ? { ...item, kanbanId: target.toKanbanId }\r\n        : item\r\n    );\r\n  });\r\n","import { useEditConfig, useAddConfig, useDeleteConfig } from './use-optimistic-options';\r\n//import { useProjectSearchParams } from './../screens/project-list/util';\r\nimport { QueryKey, useMutation } from 'react-query';\r\n//import { useCallback, useEffect } from \"react\";\r\nimport { useQuery } from \"react-query\";\r\nimport { Project } from \"types/Project\";\r\n//import { clearnObject } from \"utils\";\r\nimport { useHttp } from \"./http\";\r\n\r\n//import { useAsync } from \"./use-async\";\r\n\r\n// export const useProject = (param?: Partial<Project>) => {\r\n//     const client = useHttp();\r\n//     const {run, ...result} = useAsync<Project[]>();\r\n//     const fetchProjects = useCallback(() => client(\"projects\", {data: clearnObject(param || {})}),[client,param]);\r\n    \r\n//     //****fetchProjects() 傳回Promise(any),fetchProjects傳回 () => Promise(any)  callback函數****/\r\n//     //可參考9-5和9-4\r\n//     useEffect(() => {\r\n//         run(fetchProjects(),{\r\n//           retry: fetchProjects\r\n//         } )\r\n      \r\n//     },[param,run,fetchProjects]);  \r\n//     //run非狀態也非基本類型不可加到依賴,如果要加,要用useMemo和useCallback,見影片10-1 12:00,通常寫自訂義hook,要返回函數時要用useCallback,\r\n//     //方便其他人調用\r\n//     //也可參考:https://medium.com/%E6%89%8B%E5%AF%AB%E7%AD%86%E8%A8%98/react-optimize-performance-using-memo-usecallback-usememo-a76b6b272df3\r\n                                                      \r\n//     return result\r\n// }\r\n\r\nexport const useProjects = (param?: Partial<Project>) => {\r\n  const client = useHttp();\r\n  // return useQuery('projects',() => client(\"projects\", {data: param}))\r\n  //return useQuery<Project[],Error>(['projects', param],() => client(\"projects\", {data: param}))\r\n  return useQuery<Project[]>(['projects', param],() => client(\"projects\", {data: param}))\r\n  //改成tuple,字串'projects'是固定不會變,但param會變,只要改變就去執行useQuery去server端取資料\r\n}\r\n\r\n// export const useEditProject = () => {\r\n//     const { run, ...asyncResult } = useAsync();\r\n//     const client = useHttp();\r\n//     const mutate = (params: Partial<Project>) => {\r\n//       return run(\r\n//         client(`projects/${params.id}`, {\r\n//           data: params,\r\n//           method: \"PATCH\",\r\n//         })\r\n//       );\r\n//     };\r\n//     return {\r\n//       mutate,\r\n//       ...asyncResult,\r\n//     };\r\n//   };\r\n\r\n  export const useEditProject = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n  //  const queryClient = useQueryClient();\r\n  //  const [searchParam] = useProjectSearchParams() //useProjectSearchParams()為了要解耦合useEditProject提至外面,可看11-7 10:25\r\n  //  const queryKey = ['projects',searchParam] \r\n    return useMutation(\r\n      //可參考11-6整段\r\n      (params: Partial<Project>) => client(`projects/${params.id}` , {\r\n        method: 'PATCH',\r\n        data: params\r\n       }),\r\n       useEditConfig(queryKey)\r\n      //{\r\n      //  // onSuccess: () => queryClient.invalidateQueries('projects'),\r\n      //   onSuccess: () => queryClient.invalidateQueries(queryKey),\r\n      //   async onMutate(target) {         \r\n      //    const previousItems = queryClient.getQueryData(queryKey)\r\n      //    queryClient.setQueryData(queryKey,(old?: Project[]) => {\r\n      //          return old?.map(project => project.id === target.id ? {...project, ...target} : project) || []\r\n      //    })\r\n      //    return {previousItems}\r\n      //   },        \r\n      //   onError(error, newItem, context) {\r\n      //     queryClient.setQueryData(queryKey,(context as {previousItems: Project[] }).previousItems)\r\n      //   }\r\n      // }\r\n    )\r\n\r\n  };\r\n  \r\n  export const useAddProject = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n   // const queryClient = useQueryClient();\r\n    return useMutation(\r\n      (params: Partial<Project>) => client(`projects` , {\r\n        method: 'POST',\r\n        data: params\r\n       }),\r\n        useAddConfig(queryKey)\r\n      //{\r\n      //   onSuccess: () => queryClient.invalidateQueries('projects')\r\n      // }\r\n    )\r\n  };\r\n\r\n  export const useDeleteProject = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n   // const queryClient = useQueryClient();\r\n    return useMutation(\r\n      ({id}:{id:number}) => client(`projects/${id}` , {\r\n        method: 'DELETE'\r\n       }),\r\n        useDeleteConfig(queryKey)\r\n      //{\r\n      //   onSuccess: () => queryClient.invalidateQueries('projects')\r\n      // }\r\n    )\r\n  };\r\n\r\n  // export const useAddProject = () => {\r\n  //   const { run, ...asyncResult } = useAsync();\r\n  //   const client = useHttp();\r\n  //   const mutate = (params: Partial<Project>) => {\r\n  //     return run(\r\n  //       client(`projects/${params.id}`, {\r\n  //         data: params,\r\n  //         method: \"POST\",\r\n  //       })\r\n  //     );\r\n  //   };\r\n  //   return {\r\n  //     mutate,\r\n  //     ...asyncResult,\r\n  //   };\r\n  // };\r\n\r\n  export const useProject = ((id?: number) => {\r\n       const client = useHttp();   \r\n       return useQuery<Project>(\r\n         ['project',{id}],\r\n         () => client(`projects/${id}`),\r\n         {enabled:!!id}  //!!id 等於Boolean(id)\r\n       )\r\n  });","import { useMemo } from \"react\"\r\nimport { URLSearchParamsInit, useSearchParams } from \"react-router-dom\"\r\nimport { clearnObject } from \"utils\"\r\n\r\n//可參考8-5初步实现 useUrlQueryParam 管理 URL 参数状态 09:00\r\nexport const useUrlQueryParam = <k extends string>(keys: k[]) => {\r\n//export const useUrlQueryParam = (keys: string[]) => {\r\n    //返回頁面url中,指定鍵的參數值\r\n    \r\n   // const [searchParams, setSearchParam] = useSearchParams()\r\n   const [searchParams] = useSearchParams()\r\n   const setUrlSearchParams = useSetUrlSearchParam()\r\n    //reduce() 方法將一個累加器及陣列中每項元素（由左至右）傳入回呼函式，將陣列化為單一值\r\n    //參考https://developer.mozilla.org/zh-TW/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce\r\n    //將key 例如:name=好手&personid=18 ,合成1個數組 {name:好手,personid:18}\r\n    //解釋:例如util.ts內的useTasksModal 使用useUrlQueryParam(['editingTaskId']),透過searchParams.get(key)去url\r\n    //找editingTaskId的值假設為15,再透過reduce 形成{editingTaskId:15} 這就是...prev\r\n    return [ \r\n        useMemo(() => keys.reduce((prev,key) => {\r\n          return {...prev, [key]: searchParams.get(key) || ''}\r\n        },{}  as {[key in k]:string}), //{}  as {[key in string]:string}),\r\n        // eslint-disable-next-line\r\n        [searchParams]), \r\n      // [searchParams,keys]), //加入keys會造成無限循環     \r\n      (params: Partial<{ [key in k]: unknown }>) => {\r\n              // iterator\r\n              // iterator: https://codesandbox.io/s/upbeat-wood-bum3j?file=/src/index.js\r\n              //[] 數組 , {} 對象 , map 有部署iterator 可用for...of 遍歷 見8-7 3:00\r\n              // const o = clearnObject({\r\n              //  ...Object.fromEntries(searchParams),\r\n              //   ...params,\r\n              // }) as URLSearchParamsInit;\r\n              // return setSearchParam(o);\r\n              return  setUrlSearchParams(params)\r\n            },\r\n    ] as const\r\n    // console.log(searchParams.get('name'))\r\n    \r\n   //typescrpit認為 ['jack',12, {gender: 'male'}]是1個數組,不是tuple,所以數組的類型要一樣,但大家又不同,\r\n   //所以會變成a:(string|number|{gender: string})[] 的類型,所以要加as const返回最原始的類型\r\n   // const a = ['jack',12, {gender: 'male'}]\r\n   // const a = ['jack',12, {gender: 'male'}] as const  //返回最原始的類型\r\n  //  const a = ['12']\r\n  //  const a = ['12'] as const\r\n} \r\n  \r\nexport const useSetUrlSearchParam = () => {\r\n  const [searchParams, setSearchParam] = useSearchParams()\r\n  return  (params: {[key in string]:unknown}) => {\r\n    const o = clearnObject({\r\n      ...Object.fromEntries(searchParams),\r\n       ...params,\r\n     }) as URLSearchParamsInit;\r\n     return setSearchParam(o);\r\n  }\r\n}","//import { useAddConfig } from './../../utils/use-optimistic-options';\r\nimport { useProject } from 'utils/project';\r\nimport { useMemo } from 'react';\r\nimport { useSetUrlSearchParam, useUrlQueryParam } from 'utils/url';\r\n//import { useSearchParams } from \"react-router-dom\";\r\n\r\n//因為不會包含模板代碼所以使用ts,否則要用tsx\r\n\r\n// 项目列表搜索的参数\r\nexport const useProjectSearchParams = () => {\r\n    const [param, setParam] = useUrlQueryParam(['name','personId'])\r\n   return [ \r\n       useMemo(() => ({...param, personId: Number(param.personId) || undefined}),[param]), \r\n       setParam] as const\r\n}\r\n\r\nexport const useProjectQueryKey = () =>{\r\n const [params] = useProjectSearchParams()\r\n return ['projects', params]\r\n} \r\n\r\nexport const useProjectModal = () => {\r\n    const [{projectCreate}, setProjectCreate] = useUrlQueryParam([\r\n        \"projectCreate\",\r\n    ]);\r\n    const [{editingProjectId}, setEditingProjectId] = useUrlQueryParam([\r\n        \"editingProjectId\",\r\n    ]);\r\n   // const [_, setUrlParams] = useSearchParams();\r\n   const setUrlParams = useSetUrlSearchParam();\r\n    const {data: editingProject, isLoading } = useProject(Number(editingProjectId))\r\n    \r\n    const open = () =>  setProjectCreate({projectCreate: true})\r\n   // const close = () =>  setProjectCreate({projectCreate: undefined})\r\n    // const close = () => {\r\n    //     setProjectCreate({projectCreate: undefined});\r\n    //     setEditingProjectId({editingProjectId: undefined});\r\n    // } \r\n    const close = () => setUrlParams({ projectCreate: \"\", editingProjectId: \"\" });\r\n    const startEdit = (id: number) => setEditingProjectId({editingProjectId: id}) \r\n    \r\n    return {\r\n       // projectModalOpen: projectCreate === 'true' || !!editingProject,\r\n        projectModalOpen: projectCreate === 'true' || !!editingProjectId,\r\n        open,\r\n        close,\r\n        startEdit,\r\n        editingProject,\r\n        isLoading\r\n    }\r\n       \r\n    \r\n    // return [\r\n    //     projectCreate === 'True',\r\n    //     open,\r\n    //     close\r\n    // ] as const\r\n}","// import { render } from \"@testing-library/react\";\r\nimport { Dropdown, Menu, Modal, Table, TableProps } from \"antd\";\r\n//import { Content } from \"antd/lib/layout/layout\";\r\nimport { ButtonNoPadding } from \"components/lib\";\r\nimport { Pin } from \"components/pin\";\r\nimport dayjs from \"dayjs\";\r\n//import { memoryUsage } from \"process\";\r\n//react-router和react-router-dom關係類似 react 和react-native/react-dom/react-vr....\r\n//react 核心庫處理虛擬的,邏輯,計算...等例如useEffect,useState...等怎麼去影響dom 見8-3 9:00\r\nimport { Link } from \"react-router-dom\";\r\nimport { User } from \"types/User\";\r\nimport { useDeleteProject, useEditProject } from \"utils/project\";\r\nimport { Project } from \"../../types/Project\";\r\nimport { useProjectModal, useProjectQueryKey } from \"./util\";\r\n//RecordType 表示table 中1筆資料的型別,例如:Project 或 User型別\r\n//TableProps代表table屬性(Props)的集合\r\ninterface ListProps extends TableProps<Project> {\r\n // list: Project[];\r\n  users: User[];\r\n // refresh?: () => void;\r\n // projectButton: JSX.Element\r\n  //setProjectModalOpen: (isOpen: boolean) => void\r\n}\r\n\r\nexport const List = ({users,...props }: ListProps) => {\r\n // const {open} = useProjectModal()\r\n  const {mutate} = useEditProject(useProjectQueryKey())\r\n  \r\n  //2個參數獲取時間不一樣,先取得project.id,再取得pin 見9-3 15:00\r\n // const pinProject = (id:number) => (pin:boolean) => mutate({id, pin}).then(props.refresh)\r\n const pinProject = (id:number) => (pin:boolean) => mutate({id, pin})\r\n  //const pinProject = (id:number, pin:boolean) => mutate({id, pin})\r\n\r\n\r\n// export const List = ({ list, users }: ListProps) => {\r\n  return (\r\n  <Table rowKey={\"id\"}  \r\n    pagination={false}  \r\n    columns={[\r\n    {\r\n      title: <Pin checked={true} disabled={true} />,\r\n      render(value, project) {\r\n        return <Pin checked={project.pin}  onCheckedChange={\r\n          pinProject(project.id)  //為什麼這邊不用給pin,因為onCheckedChange會自帶pin進來,\r\n          //如:onCheckedChange= {pin => {pinProject((project.id), pin)}}\r\n        \r\n          //   pin => {\r\n        //   // useEditProject(project.id,{pin: true}) Hook不可在function內使用,只能在最外層見9-3 11:00\r\n        //   pinProject((project.id), pin) //2個參數獲取時間不一樣,先取得project.id,再取得pin 見9-3 15:00\r\n        // }\r\n      } />\r\n      }\r\n    },\r\n    {\r\n    title: '名稱',\r\n    // dataIndex: 'name',\r\n    sorter:(a,b) => a.name.localeCompare(b.name),\r\n    render(value, project) {\r\n      return <Link to={String(project.id)}>{project.name}</Link>\r\n    }\r\n  },{\r\n    title: '部門',\r\n    dataIndex: 'organization',    \r\n  }\r\n  ,{\r\n    title: '負責人',\r\n    render(value, project) {\r\n      return <span>\r\n         {users.find((user) => user.id === project.personId)?.name || \"未知\"}\r\n      </span>\r\n    }\r\n    \r\n  },{\r\n    title: '創建時間',\r\n    render(value, project) {\r\n      return <span>\r\n        {project.created? dayjs(project.created).format('YYYY-MM-DD') : '無'}\r\n      </span>\r\n    }\r\n  },\r\n  {\r\n   render(value,project) {\r\n     return <More project={project} />\r\n   }\r\n  }\r\n]}  {...props} />\r\n  //}]}  dataSource={list} />\r\n  // return (\r\n  //   <table>\r\n  //     <thead>\r\n  //       <tr>\r\n  //         <th>名称</th>\r\n  //         <th>负责人</th>\r\n  //       </tr>\r\n  //     </thead>\r\n  //     <tbody>\r\n  //       {list.map((project) => (\r\n  //         <tr key={project.id}>\r\n  //           <td>{project.name}</td>\r\n  //           {/*undefined.name*/}\r\n  //           <td>\r\n  //             {users.find((user) => user.id === project.personId)?.name ||\r\n  //               \"未知\"}\r\n  //           </td>\r\n  //         </tr>\r\n  //       ))}\r\n  //     </tbody>\r\n  //   </table>\r\n  // );\r\n  )};\r\n\r\nconst More = ( {project}: {project: Project}) => {\r\n  const {startEdit} = useProjectModal() \r\n  const editProject = (id:number) => () => startEdit(id)\r\n  const {mutate: deleteProject} = useDeleteProject(useProjectQueryKey())\r\n  const confirmDeleteProject = (id: number) => {\r\n    Modal.confirm({\r\n      title: '確定刪除項目嗎?',\r\n      content: '點擊確定刪除',\r\n      okText: '確定',\r\n      onOk() {\r\n        deleteProject({id})\r\n      }\r\n    })\r\n  }\r\n return  <Dropdown overlay= { <Menu>\r\n    <Menu.Item onClick={editProject(project.id)} key={\"edit\"}>編輯</Menu.Item >\r\n    <Menu.Item onClick={() => confirmDeleteProject(project.id)} key={\"delete\"}>刪除</Menu.Item >\r\n     {/* <ButtonNoPadding type={\"link\"} onClick={() => props.setProjectModalOpen(true)}>編輯</ButtonNoPadding> */}\r\n     {/* {props.projectButton} */}    \r\n    \r\n  </Menu>\r\n  } >\r\n    <ButtonNoPadding type={\"link\"}>...</ButtonNoPadding>\r\n  </Dropdown>\r\n\r\n}","//import { useState } from \"react\";\r\nimport { SearchPanel } from \"./search-panel\";\r\nimport { List } from \"screens/project-list/list\";\r\nimport { useDebounce, useDocumentTitle} from \"../../utils\";\r\n//import styled from \"@emotion/styled\";\r\n//import { Typography } from \"antd\";\r\nimport { useProjects } from \"utils/project\";\r\nimport { useUsers } from \"utils/user\";\r\nimport { useUrlQueryParam } from \"utils/url\";\r\n//import { useSearchParams } from \"react-router-dom\";\r\nimport { useProjectModal, useProjectSearchParams } from \"./util\";\r\nimport { ButtonNoPadding, ErrorBox, Row, ScreenContainer } from \"components/lib\";\r\n\r\n//import { Test } from \"./test\";\r\n//import { Helmet } from \"react-helmet\";\r\n//import {useEffect, useState } from \"react\";\r\n//import {List, Project} from \"screens/project-list/list\";\r\n//import {clearnObject, useDebounce, useMount} from \"../../utils\";\r\n//import { useHttp } from \"utils/http\";\r\n//import { useAsync } from \"utils/use-async\";\r\n// import * as qs from \"qs\";\r\n\r\n// const apiUrl = process.env.REACT_APP_API_URL; // 'http://localhost:3001'\r\n //props: {setProjectModalOpen: (isOpen: boolean) => void}\r\n//export const ProjectListScreen = (props:{projectButton: JSX.Element}) => {\r\nexport const ProjectListScreen = () => {\r\n    // const [users, setUsers] = useState([])\r\n    // const [isLoading, setIsLoading] = useState(false)\r\n    // const [error, setError] = useState<null | Error>(null)\r\n\r\n   // const [keys] = useState<('name'|'personId')[]>(['name','personId'])\r\n   // const [param, setParam] = useUrlQueryParam(keys)\r\n\r\n   //基本类型，可以放到依赖里；组件状态，可以放到依赖里；非组件状态的对象，绝不可以放到依赖里\r\n     //https://codesandbox.io/s/keen-wave-tlz9s?file=/src/App.js\r\n     //param 通常只會只有1組值,因為不管選取或輸入文字都是只有1組name和personId,不是陣列,把他想成查詢條件\r\n    // const [param, setParam] = useUrlQueryParam(['name','personId'])\r\n    //推論param每次都創建一個新的對象才造成useDebounce 內的useEffect 一直觸發,造成頁面一直渲染,可看8-6 8:16\r\n    //去查useUrlQueryParam內的reduce\r\n    // const projectsParam = {...param, personId: Number(param.personId) || undefined }\r\n    const [param, setParam] = useProjectSearchParams()\r\n   // const debouncedParam = useDebounce(projectsParam,200);\r\n    // const [list, setList] = useState([]);\r\n    //const client = useHttp();\r\n   // const {isLoading, error, data: list, retry} = useProject(useDebounce(param,200));\r\n   const {isLoading, error, data: list } = useProjects(useDebounce(param,200));\r\n    const { data: users} = useUsers();\r\n\r\n    // const {run, isLoading, error, data: list} = useAsync<Project[]>();\r\n\r\n    // useEffect(() => {\r\n    //   run(client(\"projects\", {data: clearnObject(debouncedParam)}))\r\n\r\n    //   // setIsLoading(true)\r\n    //   // setError(null)\r\n\r\n    //   // client(\"projects\", {data: clearnObject(debouncedParam)})\r\n    //   // .then(setList)\r\n    //   // .catch((error:Error) => {\r\n    //   //   setList([])\r\n    //   //   setError(error)\r\n    //   // })\r\n    //   // .finally(() => setIsLoading(false))\r\n    //   // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    // },[debouncedParam]);\r\n      //qs.stringify幫我我做的是把自動對應 name=${param.name} & personId=${param.personId},\r\n      //但有些欄位可能沒值,這會影響查詢結果,所以要clearnObject(debounceParam)把沒值的去掉\r\n    //   fetch(`${apiUrl}/projects?${qs.stringify(clearnObject(debounceParam))}`).then(async response => {\r\n    //     if (response.ok) {\r\n    //       setList(await response.json())\r\n    //     }\r\n    //   })\r\n    // },[debounceParam])  // 當param變化時去取資料\r\n\r\n    // useEffect(() => {\r\n    //     fetch(`${apiUrl}/users`).then(async response =>{\r\n    //         if (response.ok) {\r\n    //             setUsers (await response.json())\r\n    //         }\r\n    //     })\r\n    // },[]) //空數組是表示只在頁面加載時執行一次(組件加載時只執行一次)\r\n\r\n    // useMount(() => {\r\n    //   client(\"users\").then(setUsers);\r\n    //   // fetch(`${apiUrl}/users`).then(async response => {\r\n    //   //   if (response.ok) {\r\n    //   //     setUsers (await response.json())\r\n    //   //   }\r\n    //   // })\r\n    // })\r\n\r\n    useDocumentTitle('項目列表',false);\r\n    const {open} = useProjectModal()\r\n    //useUrlQueryParam(['random']);\r\n    console.log(useUrlQueryParam(['name']));\r\n  //  console.log(useUrlQueryParam(['personid']));\r\n    return <ScreenContainer>\r\n      {/* <Test/> */}\r\n      {/* <Helmet>\r\n      <title>項目列表</title>\r\n      </Helmet> */}\r\n      <Row between= {true}>\r\n      <h1>項目列表</h1>\r\n      {/* <Button onClick={() => props.setProjectModalOpen(true)}>創建項目</Button> */}\r\n      {/* {props.projectButton} */}\r\n      <ButtonNoPadding \r\n           onClick={open} \r\n           type={\"link\"}>\r\n              創建項目\r\n      </ButtonNoPadding>\r\n      </Row>\r\n      <SearchPanel users={users || []}  param={param} setParam={setParam}/>\r\n      <ErrorBox error = {error} />\r\n      {/* {error? <Typography.Text type={\"danger\"}>{error.message}</Typography.Text> : null} */}\r\n      {/* <List setProjectModalOpen={props.setProjectModalOpen} refresh={retry} loading={isLoading} users={users || []} dataSource={list || []}/>    */}\r\n      \r\n      {/* <List\r\n        projectButton = {props.projectButton}\r\n        refresh={retry}\r\n        loading={isLoading}\r\n        users={users || []}\r\n        dataSource={list || []}\r\n      /> */}\r\n        {/* <List\r\n        refresh={retry}\r\n        loading={isLoading}\r\n        users={users || []}\r\n        dataSource={list || []}\r\n      /> */}\r\n      <List\r\n        loading={isLoading}\r\n        users={users || []}\r\n        dataSource={list || []}\r\n      />\r\n    </ScreenContainer>\r\n}\r\n\r\n//function Component寫法\r\nProjectListScreen.whyDidYouRender = false;\r\n\r\n//class Component寫法\r\n// class test extends Component<any,any> {\r\n//   static whyDidYouRender = true\r\n// }\r\n\r\n// const Container = styled.div`\r\n//   padding: 3.2rem;\r\n// `;","var _defs, _g;\n\nvar _excluded = [\"title\", \"titleId\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nimport * as React from \"react\";\n\nfunction SvgSoftwareLogo(_ref, svgRef) {\n  var title = _ref.title,\n      titleId = _ref.titleId,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 179 32\",\n    xmlns: \"http://www.w3.org/2000/svg\",\n    focusable: \"false\",\n    \"aria-hidden\": \"true\",\n    className: \"css-sq9aeg-Logo\",\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, _defs || (_defs = /*#__PURE__*/React.createElement(\"defs\", null, /*#__PURE__*/React.createElement(\"linearGradient\", {\n    x1: \"97.6553341%\",\n    y1: \"35.6591143%\",\n    x2: \"37.202032%\",\n    y2: \"75.4891864%\",\n    id: \"uid392-1\"\n  }, /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#0052CC\",\n    offset: \"7%\"\n  }), /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#2684FF\",\n    offset: \"100%\"\n  })), /*#__PURE__*/React.createElement(\"linearGradient\", {\n    x1: \"8.43371138%\",\n    y1: \"60.1495759%\",\n    x2: \"64.1161517%\",\n    y2: \"23.5790285%\",\n    id: \"uid392-2\"\n  }, /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#0052CC\",\n    offset: \"0%\"\n  }), /*#__PURE__*/React.createElement(\"stop\", {\n    stopColor: \"#2684FF\",\n    offset: \"100%\"\n  })))), _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    stroke: \"none\",\n    strokeWidth: 1,\n    fillRule: \"nonzero\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M11.3881081,27.9242105 C12.4881804,26.8071817 13.1062496,25.2917664 13.1062496,23.7115789 C13.1062496,22.1313915 12.4881804,20.6159762 11.3881081,19.4989474 L11.3881081,19.4989474 L3.74837838,11.7621053 L0.273513514,15.2926316 C-0.0900771727,15.6625064 -0.0900771727,16.2617042 0.273513514,16.6315789 L11.3881081,27.9242105 L11.3881081,27.9242105 Z\",\n    fill: \"currentColor\",\n    fillRule: \"nonzero\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M22.5027027,15.2926316 L11.3881081,4 L11.3881081,4 L11.3539189,4.03473684 L11.3539189,4.03473684 C9.08852466,6.36456187 9.09963243,10.1156459 11.3787838,12.4315789 L19.0247297,20.1652632 L22.5027027,16.6315789 C22.8662934,16.2617042 22.8662934,15.6625064 22.5027027,15.2926316 Z\",\n    fill: \"currentColor\",\n    fillRule: \"nonzero\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M11.3881081,12.4252632 C9.10895676,10.1093301 9.09784899,6.35824608 11.3632432,4.02842105 L3.43445946,12.0810526 L7.58067568,16.2936842 L11.3881081,12.4252632 Z\",\n    fill: \"url(#uid392-1)\",\n    fillRule: \"nonzero\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M15.1893243,15.6368421 L11.3881081,19.4989474 C12.4881804,20.6159762 13.1062496,22.1313915 13.1062496,23.7115789 C13.1062496,25.2917664 12.4881804,26.8071817 11.3881081,27.9242105 L19.3355405,19.8494737 L15.1893243,15.6368421 Z\",\n    fill: \"url(#uid392-2)\",\n    fillRule: \"nonzero\"\n  }), /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M36.07,18.956 C36.07,20.646 35.394,21.842 33.418,21.842 C32.56,21.842 31.702,21.686 31,21.4 L31,23.662 C31.65,23.896 32.586,24.104 33.808,24.104 C37.032,24.104 38.41,21.946 38.41,18.8 L38.41,6.918 L36.07,6.918 L36.07,18.956 Z M41.894,7.568 C41.894,8.556 42.544,9.128 43.454,9.128 C44.364,9.128 45.014,8.556 45.014,7.568 C45.014,6.58 44.364,6.008 43.454,6.008 C42.544,6.008 41.894,6.58 41.894,7.568 Z M42.31,24 L44.546,24 L44.546,11 L42.31,11 L42.31,24 Z M47.926,24 L50.11,24 L50.11,16.33 C50.11,13.574 51.852,12.716 54.712,13.002 L54.712,10.818 C52.164,10.662 50.864,11.754 50.11,13.288 L50.11,11 L47.926,11 L47.926,24 Z M65.45,24 L65.45,21.66 C64.618,23.376 63.058,24.26 61.056,24.26 C57.598,24.26 55.856,21.322 55.856,17.5 C55.856,13.834 57.676,10.74 61.316,10.74 C63.214,10.74 64.67,11.598 65.45,13.288 L65.45,11 L67.686,11 L67.686,24 L65.45,24 Z M58.092,17.5 C58.092,20.62 59.34,22.18 61.654,22.18 C63.656,22.18 65.45,20.906 65.45,18.02 L65.45,16.98 C65.45,14.094 63.812,12.82 61.914,12.82 C59.392,12.82 58.092,14.484 58.092,17.5 Z M86.926,19.294 C86.926,16.226 84.898,15.056 81.284,14.146 C78.268,13.392 77.176,12.69 77.176,11.286 C77.176,9.726 78.502,8.946 80.738,8.946 C82.506,8.946 84.352,9.258 86.068,10.246 L86.068,7.906 C84.898,7.256 83.312,6.658 80.842,6.658 C76.864,6.658 74.836,8.634 74.836,11.286 C74.836,14.094 76.552,15.42 80.4,16.356 C83.65,17.136 84.586,17.942 84.586,19.45 C84.586,20.958 83.624,21.972 81.05,21.972 C78.788,21.972 76.344,21.374 74.758,20.542 L74.758,22.934 C76.084,23.61 77.618,24.26 80.92,24.26 C85.158,24.26 86.926,22.258 86.926,19.294 Z M95.09,24.26 C91.19,24.26 88.902,21.374 88.902,17.474 C88.902,13.574 91.19,10.74 95.09,10.74 C98.964,10.74 101.226,13.574 101.226,17.474 C101.226,21.374 98.964,24.26 95.09,24.26 Z M95.09,12.82 C92.308,12.82 91.086,15.004 91.086,17.474 C91.086,19.944 92.308,22.18 95.09,22.18 C97.846,22.18 99.042,19.944 99.042,17.474 C99.042,15.004 97.846,12.82 95.09,12.82 Z M106.92,9.622 C106.92,8.452 107.596,7.646 108.974,7.646 C109.494,7.646 109.988,7.698 110.378,7.776 L110.378,5.722 C109.988,5.618 109.546,5.514 108.87,5.514 C106.088,5.514 104.736,7.152 104.736,9.57 L104.736,11 L102.63,11 L102.63,13.08 L104.736,13.08 L104.736,24 L106.92,24 L106.92,13.08 L110.274,13.08 L110.274,11 L106.92,11 L106.92,9.622 Z M115.786,19.892 L115.786,13.08 L119.244,13.08 L119.244,11 L115.786,11 L115.786,8.244 L113.602,8.244 L113.602,11 L111.496,11 L111.496,13.08 L113.602,13.08 L113.602,19.944 C113.602,22.362 114.954,24 117.736,24 C118.412,24 118.854,23.896 119.244,23.792 L119.244,21.634 C118.854,21.712 118.36,21.816 117.84,21.816 C116.462,21.816 115.786,21.036 115.786,19.892 Z M125.432,24 L128.292,24 L130.528,17.708 L131.724,13.704 L132.92,17.708 L135.156,24 L138.016,24 L142.8,11 L140.33,11 L136.586,22.024 L132.79,11 L130.658,11 L126.862,22.024 L123.118,11 L120.648,11 L125.432,24 Z M153.538,24 L153.538,21.66 C152.706,23.376 151.146,24.26 149.144,24.26 C145.686,24.26 143.944,21.322 143.944,17.5 C143.944,13.834 145.764,10.74 149.404,10.74 C151.302,10.74 152.758,11.598 153.538,13.288 L153.538,11 L155.774,11 L155.774,24 L153.538,24 Z M146.18,17.5 C146.18,20.62 147.428,22.18 149.742,22.18 C151.744,22.18 153.538,20.906 153.538,18.02 L153.538,16.98 C153.538,14.094 151.9,12.82 150.002,12.82 C147.48,12.82 146.18,14.484 146.18,17.5 Z M159.154,24 L161.338,24 L161.338,16.33 C161.338,13.574 163.08,12.716 165.94,13.002 L165.94,10.818 C163.392,10.662 162.092,11.754 161.338,13.288 L161.338,11 L159.154,11 L159.154,24 Z M178.108,23.48 C177.042,24.052 175.404,24.26 174.078,24.26 C169.216,24.26 167.084,21.452 167.084,17.474 C167.084,13.548 169.268,10.74 173.22,10.74 C177.224,10.74 178.836,13.522 178.836,17.474 L178.836,18.488 L169.346,18.488 C169.658,20.698 171.088,22.128 174.156,22.128 C175.664,22.128 176.938,21.842 178.108,21.426 L178.108,23.48 Z M173.116,12.768 C170.75,12.768 169.554,14.302 169.32,16.564 L176.574,16.564 C176.444,14.146 175.352,12.768 173.116,12.768 Z\",\n    fill: \"inherit\",\n    fillRule: \"evenodd\"\n  }))));\n}\n\nvar ForwardRef = /*#__PURE__*/React.forwardRef(SvgSoftwareLogo);\nexport default __webpack_public_path__ + \"static/media/software-logo.ec204298.svg\";\nexport { ForwardRef as ReactComponent };","import { cloneElement, forwardRef, HTMLAttributes, isValidElement,  ReactNode } from \"react\"\r\nimport { Draggable, DraggableProps,  Droppable, DroppableProps,DroppableProvided,DroppableProvidedProps } from \"react-beautiful-dnd\"\r\n\r\ntype DropProps = Omit<DroppableProps,'children'> & {children: ReactNode }\r\nexport const Drop = ({children,...props}: DropProps) => {\r\n   return <Droppable {...props}>{\r\n       (provided => {\r\n           if (isValidElement(children)) {\r\n             return cloneElement(children,{\r\n                ...provided.droppableProps,\r\n                ref: provided.innerRef,\r\n                provided\r\n             })\r\n           }\r\n           return <div/>\r\n       })\r\n   }</Droppable>\r\n}\r\n\r\ntype DropChildProps = \r\n    Partial<{provided: DroppableProvided} & DroppableProvidedProps> & \r\n    HTMLAttributes<HTMLDivElement>\r\nexport const DropChild = forwardRef<HTMLDivElement,DropChildProps>(\r\n    ({children,...props},ref ) =><div ref={ref} {...props}>\r\n        {children}\r\n        {props.provided?.placeholder}\r\n        </div>\r\n    )\r\n\r\n\r\n\r\ntype DragProps = Omit<DraggableProps,'children'> & {children: ReactNode }\r\nexport const Drag = ({children,...props}: DragProps) => {\r\n    return <Draggable {...props}>{\r\n           (provided => {\r\n               if (isValidElement(children)) {\r\n                 return cloneElement(children,{\r\n                    ...provided.draggableProps,\r\n                    ...provided.dragHandleProps,\r\n                    ref: provided.innerRef\r\n                 })\r\n               }\r\n               return <div/>\r\n           })\r\n    }</Draggable>\r\n}\r\n\r\n","import { QueryKey, useMutation, useQuery } from \"react-query\";\r\nimport { Kanban } from \"types/kanban\";\r\nimport { useHttp } from \"./http\";\r\nimport { useAddConfig, useDeleteConfig,  useReorderKanbanConfig } from \"./use-optimistic-options\";\r\n\r\nexport const useKanbans = (param?: Partial<Kanban>) => {\r\n    const client = useHttp();\r\n    return useQuery<Kanban[]>(['kanbans', param],() => client(\"kanbans\", {data: param}))\r\n    //改成tuple,字串'kanbans'固定不會變,但param會變,只要改變就去執行useQuery去server端取資料\r\n  }\r\n\r\nexport const useAddKanban = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n   // const queryClient = useQueryClient();\r\n    return useMutation(\r\n      (params: Partial<Kanban>) => client(`kanbans` , {\r\n        method: 'POST',\r\n        data: params\r\n       }),\r\n        useAddConfig(queryKey)\r\n      //{\r\n      //   onSuccess: () => queryClient.invalidateQueries('projects')\r\n      // }\r\n    )\r\n};\r\n\r\nexport const useDeleteKanban = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    ({id}:{id:number}) => client(`kanbans/${id}` , {\r\n      method: 'DELETE'\r\n     }),\r\n      useDeleteConfig(queryKey)\r\n  )\r\n};\r\n\r\nexport interface SortProps {\r\n  //要重新排序的item\r\n  fromId: number;\r\n  //目標item\r\n  referenceId: number;\r\n  //放在目標item的前或後\r\n  type: 'before' | 'after';\r\n  fromKanbanId?: number;\r\n  toKanbanId?: number;\r\n}\r\n\r\nexport const useReorderKanban = (queryKey:QueryKey) => {\r\n const client = useHttp()\r\n return useMutation(\r\n   (params: SortProps) => {\r\n        return client('kanbans/reorder',{\r\n          data: params,\r\n          method: 'POST'\r\n        })\r\n   },\r\n   useReorderKanbanConfig(queryKey)\r\n )\r\n}","import { Task } from './../types/task';\r\nimport { QueryKey, useMutation, useQuery } from \"react-query\";\r\nimport { useHttp } from \"./http\";\r\nimport { useAddConfig, useDeleteConfig, useEditConfig, useReorderTaskConfig } from './use-optimistic-options';\r\nimport { SortProps } from './kanban';\r\n\r\n\r\nexport const useTasks = (param?: Partial<Task>) => {\r\n    const client = useHttp();\r\n    return useQuery<Task[]>(['tasks', param],() => client(\"tasks\", {data: param}))\r\n    //改成tuple,字串'kanbans'固定不會變,但param會變,只要改變就去執行useQuery去server端取資料\r\n  }\r\n\r\nexport const useAddTask = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n    return useMutation(\r\n      (params: Partial<Task>) => client(`tasks` , {\r\n        method: 'POST',\r\n        data: params\r\n       }),\r\n        useAddConfig(queryKey)\r\n    )\r\n};\r\n\r\nexport const useTask = ((id?: number) => {\r\n  const client = useHttp();   \r\n  return useQuery<Task>(\r\n    ['task',{id}],\r\n    () => client(`tasks/${id}`),\r\n    {enabled:!!id}  //!!id 等於Boolean(id)\r\n  )\r\n});\r\n\r\nexport const useEditTask = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    //可參考11-6整段\r\n    (params: Partial<Task>) => client(`tasks/${params.id}` , {\r\n      method: 'PATCH',\r\n      data: params\r\n     }),\r\n     useEditConfig(queryKey)\r\n  )\r\n};\r\n\r\nexport const useDeleteTask = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    ({id}:{id:number}) => client(`tasks/${id}` , {\r\n      method: 'DELETE'\r\n     }),\r\n      useDeleteConfig(queryKey)\r\n  )\r\n};\r\n\r\n\r\n\r\n\r\nexport const useReorderTask = (queryKey:QueryKey) => {\r\n const client = useHttp()\r\n return useMutation(\r\n   (params: SortProps) => {\r\n        return client('tasks/reorder',{\r\n          data: params,\r\n          method: 'POST'\r\n        })\r\n   },\r\n   useReorderTaskConfig(queryKey)\r\n )\r\n}","import { useQuery } from \"react-query\";\r\nimport { useHttp } from \"./http\";\r\nimport { TaskType } from 'types/task-type';\r\n\r\n\r\n\r\nexport const useTaskTypes = () => {\r\n    const client = useHttp();\r\n    return useQuery<TaskType[]>(['taskTypes'],() => client(\"taskTypes\"))\r\n    //改成tuple,字串'kanbans'固定不會變,但param會變,只要改變就去執行useQuery去server端取資料\r\n  }\r\n\r\n","//import { useDebounce } from \"utils\";\r\nimport { useCallback } from 'react';\r\nimport { useUrlQueryParam } from 'utils/url';\r\nimport { useProject } from './../../utils/project';\r\nimport { useLocation } from \"react-router\"\r\nimport { useMemo } from 'react';\r\nimport { useTask } from 'utils/task';\r\n\r\nexport const useProjectIdInUrl = () => {\r\n    const {pathname} = useLocation()\r\n    //見12-3 3:00\r\n    const id = pathname.match(/projects\\/(\\d+)/)?.[1]\r\n    return Number(id)\r\n}\r\n\r\nexport const useProjectInUrl = () => useProject(useProjectIdInUrl())\r\n\r\nexport const useKanbanSearchParams = () => ({projectId: useProjectIdInUrl()})\r\n\r\nexport const useKanbansQueryKey = () => ['kanbans', useKanbanSearchParams()]\r\n\r\n// export const useTasksSearchParams = () => ({projectId: useProjectIdInUrl()})\r\n\r\nexport const useTasksSearchParams = () => {\r\n     const [param, setParam] = useUrlQueryParam([\r\n         'name',\r\n         'typeId',\r\n         'processorId', //負責人\r\n         'tagId'\r\n     ]) \r\n    \r\n    const  projectId= useProjectIdInUrl();\r\n   // const debouncedParam = { ...param, name: useDebounce(param?.name, 200) };\r\n  //  const  debouncedName= useDebounce(param.name,200)\r\n    return   useMemo(() => ({\r\n        projectId,\r\n        typeId: Number(param.typeId) || undefined,\r\n        processorId: Number(param.processorId) || undefined,\r\n        tagId: Number(param.tagId) || undefined,\r\n        name: param.name\r\n    }),[projectId, param]);\r\n\r\n}\r\n\r\n\r\nexport const useTasksQueryKey = () => ['tasks', useTasksSearchParams()]\r\n\r\nexport const useTasksModal = () => {\r\n\r\n    const [{editingTaskId},setEditingTaskId] = useUrlQueryParam(['editingTaskId'])\r\n    const {data: editingTask, isLoading} = useTask(Number(editingTaskId)) //找尋該筆Editing id的值\r\n\r\n    const startEdit = useCallback((id: number) => {\r\n        setEditingTaskId({editingTaskId: id})   \r\n    },[setEditingTaskId])\r\n\r\n    const close = useCallback(() => {\r\n           setEditingTaskId({editingTaskId: ''})\r\n    },[setEditingTaskId])\r\n    return {\r\n        editingTaskId,\r\n        editingTask,\r\n        startEdit,\r\n        close,\r\n        isLoading\r\n    }\r\n\r\n}","export default __webpack_public_path__ + \"static/media/task.69774797.svg\";","export default __webpack_public_path__ + \"static/media/bug.5d8e8fd5.svg\";","import { Card, Input } from \"antd\"\r\nimport { useEffect, useState } from \"react\"\r\nimport { useAddTask } from \"utils/task\"\r\nimport { useProjectIdInUrl, useTasksQueryKey } from \"./util\"\r\n\r\nexport const CreateTask = ({kanbanId}: {kanbanId: number}) => {\r\n    const [name,setName] = useState('')\r\n    const {mutateAsync: addTask} = useAddTask(useTasksQueryKey())\r\n    const projectId = useProjectIdInUrl()\r\n    const [inputMode,setInputMode] = useState(false)\r\n\r\n    const submit = async () => {\r\n        await addTask({projectId, name, kanbanId})\r\n        setInputMode(false)\r\n        setName('')\r\n        }\r\n\r\n    const toggle = () => setInputMode(mode => !mode)\r\n\r\n    useEffect(() => {\r\n        if(!inputMode) {\r\n            setName('')\r\n        }\r\n    }, [inputMode])\r\n\r\n    if (!inputMode) {\r\n        return <div onClick={toggle}>創建事務</div>\r\n    }\r\n    \r\n    return <Card>\r\n        <Input onBlur={toggle} \r\n        placeholder={'需要做些甚麼'} \r\n        autoFocus={true} \r\n        onPressEnter={submit} \r\n        value={name}\r\n        onChange={evt=> setName(evt.target.value)}/>\r\n    </Card>\r\n\r\n}","export const Mark = ({name, keyword}:{name:string, keyword:string}) => {\r\n   if (!keyword) {\r\n       return <> {name} </>\r\n   }\r\n   const arr = name.split(keyword)\r\n   return <> \r\n     {\r\n        arr.map((str,index) => <span key={index}>\r\n            {str}\r\n            {\r\n                index === arr.length-1 ? null : <span style={{color:'#257AFD' }}>\r\n                   {keyword}\r\n                </span>\r\n            }\r\n        </span> ) \r\n     }\r\n   </>\r\n}","import { Kanban } from \"types/kanban\";\r\nimport { useTasks } from \"utils/task\";\r\nimport { useTaskTypes } from \"utils/task-type\";\r\nimport { useKanbansQueryKey, useTasksModal, useTasksSearchParams } from \"./util\";\r\nimport taskicon from 'assets/task.svg';\r\nimport bugicon from 'assets/bug.svg';\r\nimport styled from \"@emotion/styled\";\r\nimport { Button, Card, Dropdown, Menu, Modal } from \"antd\";\r\nimport { CreateTask } from \"./create-task\";\r\nimport { Task } from \"types/task\";\r\nimport { Mark } from \"components/mark\";\r\nimport { useDeleteKanban } from \"utils/kanban\";\r\nimport { Row } from \"components/lib\";\r\nimport { forwardRef } from \"react\";\r\nimport { Drag, Drop, DropChild } from \"components/drag-and-drop\";\r\n\r\nexport const TaskTypeIcon = ({id}:{id:number}) => {\r\n   const {data: taskTypes} = useTaskTypes()\r\n   const name = taskTypes?.find((task) => task.id === id )?.name\r\n   if (!name) {\r\n     return null\r\n   }\r\n   return <img alt={'task-icon'} src={name === 'task' ? taskicon : bugicon} />  \r\n}\r\n\r\nconst TaskCard = ({task}:{task:Task}) => {\r\n  const {startEdit} = useTasksModal()\r\n  const {name: keyword}=useTasksSearchParams()\r\n  return <Card onClick={() => startEdit(task.id)} style={{marginBottom: '0.5rem', cursor: 'pointer'}} key={task.id}>\r\n        {/* <div>{task.name}</div> */}\r\n        <p>\r\n         <Mark keyword={keyword} name={task.name}/> \r\n        </p>           \r\n      <TaskTypeIcon id={task.typeId} />\r\n    </Card>\r\n}\r\n\r\nexport const KanbanColumn = forwardRef<HTMLDivElement,{kanban:Kanban}>(({kanban,...props},ref) => {\r\n   const {data: allTasks} = useTasks(useTasksSearchParams())\r\n   const tasks = allTasks?.filter(task => task.kanbanId === kanban.id)\r\n   \r\n    return <Container {...props} ref={ref} >\r\n      <Row between={true}>\r\n      <h3>{kanban.name}</h3>\r\n      <More kanban={kanban} key={kanban.id}/>\r\n      </Row>\r\n        \r\n      <TasksContainer>\r\n        <Drop type={'ROW'} direction={'vertical'} droppableId={String(kanban.id)} >\r\n          <DropChild style={{ minHeight: \"1rem\" }}>\r\n        { tasks?.map((task,taskIndex) => (\r\n          <Drag key={task.id} index={taskIndex} draggableId={'task'+task.id}>\r\n            <div>\r\n              <TaskCard key={task.id} task={task} />\r\n            </div>           \r\n          </Drag>\r\n          ))}\r\n         </DropChild>\r\n        </Drop>\r\n        <CreateTask kanbanId={kanban.id} />\r\n      </TasksContainer>\r\n    </Container>\r\n})\r\n\r\nconst More = ({kanban}:{kanban:Kanban}) => {\r\n  const {mutateAsync} = useDeleteKanban(useKanbansQueryKey())\r\n\r\n  const startEdit = () => {\r\n    Modal.confirm({\r\n      title: '確定刪除看板嗎?',\r\n      cancelText: '取消',\r\n      okText: '確定',\r\n      onOk() {\r\n      return  mutateAsync({id:kanban.id})\r\n      }\r\n    })\r\n  } \r\n  const overlay = <Menu>\r\n    <Menu.Item>\r\n       <Button type={'link'} onClick={startEdit}>\r\n         刪除\r\n       </Button> \r\n    </Menu.Item>\r\n  </Menu>\r\n\r\n  return <Dropdown overlay={overlay}>\r\n    <Button type={'link'}>...</Button>\r\n  </Dropdown>\r\n}\r\n\r\nexport const Container = styled.div `\r\nmin-width: 27rem;\r\nborder-radius: 6px;\r\nbackground-color: rgb(244,245,247);\r\ndisplay: flex;\r\nflex-direction: column;\r\npading: 0.7rem 0.7rem 1rem;\r\nmargin-right: 1.5rem;\r\n`\r\n\r\n\r\nconst TasksContainer = styled.div `\r\n overflow: scroll;\r\n flex: 1;\r\n ::-Webkit-scrollbar {\r\n     display: none;\r\n }\r\n`","import { Input } from \"antd\"\r\nimport { useState } from \"react\"\r\nimport { useAddKanban } from \"utils/kanban\"\r\nimport { Container } from \"./kanban-column\"\r\nimport { useKanbansQueryKey, useProjectIdInUrl } from \"./util\"\r\n\r\nexport const CreateKanban = () => {\r\n    const [name, setName] = useState('')\r\n    const projectId = useProjectIdInUrl()\r\n    const {mutateAsync: addKanban} = useAddKanban(useKanbansQueryKey())\r\n\r\n    const submit = async () => {\r\n    await addKanban({name, projectId})\r\n    setName('')\r\n    }\r\n\r\n    return <Container>\r\n       <Input size={'large'} placeholder={'新建看板名稱'} onPressEnter={submit} value={name} \r\n       onChange={evt =>setName(evt.target.value) }/>\r\n    </Container>\r\n\r\n}","import { IdSelect } from \"components/id-select\";\r\nimport { ComponentProps } from \"react\";\r\nimport { useTaskTypes } from \"utils/task-type\";\r\n\r\nexport const TaskTypeSelect = (props: ComponentProps<typeof IdSelect>) => {\r\n    \r\n    const { data: taskTypes} = useTaskTypes();\r\n    \r\n    return <IdSelect options={taskTypes || []} {...props}/>\r\n};","import { Button, Input } from \"antd\";\r\nimport { Row } from \"components/lib\";\r\nimport { TaskTypeSelect } from \"components/task-type-select\";\r\nimport { UserSelect } from \"components/user-select\";\r\nimport { useSetUrlSearchParam } from \"utils/url\";\r\nimport { useTasksSearchParams } from \"./util\"\r\n\r\nexport const SearchPanel = () => {\r\n    const serachParams = useTasksSearchParams();\r\n    const setSearchParams = useSetUrlSearchParam();\r\n    const reset = () => {\r\n        setSearchParams({\r\n        typeId: undefined,\r\n        processorId: undefined,\r\n        tagId: undefined,\r\n        name: undefined\r\n        })\r\n    }\r\n\r\n    return <Row marginBottom={4} gap={true} >\r\n        <Input style={{width: '20rem'}} placeholder={'任務名'} value={serachParams.name} \r\n         onChange={(evt) => setSearchParams({name: evt.target.value})  }/>\r\n        <UserSelect defaultOptionName={'經辦人'} value={serachParams.processorId}\r\n         onChange={(value) => setSearchParams({processorId: value})}/> \r\n        <TaskTypeSelect defaultOptionName={'類型'} value={serachParams.typeId}\r\n         onChange={(value) => setSearchParams({typeId: value})}/>\r\n         <Button onClick={reset}>清除篩選器</Button> \r\n    </Row>\r\n}","import { Button, Form, Input, Modal } from \"antd\"\r\nimport { useForm } from \"antd/lib/form/Form\"\r\nimport { TaskTypeSelect } from \"components/task-type-select\"\r\nimport { UserSelect } from \"components/user-select\"\r\nimport { useEffect } from \"react\"\r\nimport { useDeleteTask, useEditTask } from \"utils/task\"\r\nimport { useTasksModal, useTasksQueryKey } from \"./util\"\r\n\r\nconst layout = {\r\n  labelCol: {span: 8},\r\n  wrapperCol: {span:16}\r\n}\r\nexport const TaskModal = () => {\r\n    const [form] = useForm()\r\n    const {editingTaskId,editingTask,close} = useTasksModal() //從url抓取資料\r\n    const {mutateAsync: editTask,isLoading: editLoading }= useEditTask(useTasksQueryKey())\r\n    const {mutate: deleteTask} = useDeleteTask(useTasksQueryKey())\r\n    const onCancel = () => {\r\n      close()\r\n      form.resetFields()\r\n    }\r\n    \r\n    // 編輯的資料寫入後端server\r\n    const onOk = async () => {\r\n       await editTask({...editingTask, ...form.getFieldsValue()})\r\n       close()\r\n    }\r\n\r\n    const startDelete = () => {\r\n      close()\r\n      Modal.confirm({\r\n        title: '確定刪除看板嗎?',\r\n        cancelText: '取消',\r\n        okText: '確定',\r\n        onOk() {\r\n        return  deleteTask({id: Number(editingTaskId)})\r\n        }\r\n      })\r\n    }\r\n    \r\n    //當url有變或form的資料有變,要重新改變form的setFieldsValue\r\n    useEffect(() => {\r\n       form.setFieldsValue(editingTask)\r\n    },[form, editingTask])\r\n\r\n    return <Modal forceRender={true} onCancel={onCancel} onOk={onOk} okText={'確認'} cancelText={'取消'} confirmLoading={editLoading} title={'編輯任務'} visible={!!editingTaskId}>\r\n       <Form {...layout} initialValues={editingTask} form={form}>\r\n           <Form.Item label={'任務名'} name={'name'} rules={[{required: true, message:'請輸入任務名' }]}>\r\n             <Input/>\r\n           </Form.Item>\r\n           <Form.Item label={'經辦人'} name={'processorId'}>\r\n             <UserSelect defaultOptionName={'經辦人'}/> \r\n           </Form.Item>\r\n           <Form.Item label={'類型'} name={'typeId'} rules={[{required: true, message:'請輸入任務名' }]}>\r\n              <TaskTypeSelect/>\r\n           </Form.Item>\r\n       </Form>\r\n       <div style={{textAlign: 'right'}}>\r\n        <Button onClick={startDelete} style={{fontSize: '14px'}} size={\"small\"}>刪除</Button>\r\n       </div>\r\n    </Modal>\r\n\r\n}\r\n\r\n","import styled from \"@emotion/styled\";\r\nimport { Spin } from \"antd\";\r\nimport { Drag, Drop, DropChild } from \"components/drag-and-drop\";\r\nimport { ScreenContainer } from \"components/lib\";\r\nimport { useCallback } from \"react\";\r\nimport { DragDropContext, DropResult } from \"react-beautiful-dnd\";\r\nimport { useDocumentTitle } from \"utils\"\r\nimport { useKanbans, useReorderKanban } from \"utils/kanban\"\r\nimport { useReorderTask, useTasks } from \"utils/task\";\r\nimport { CreateKanban } from \"./create-kanban\";\r\nimport { KanbanColumn } from \"./kanban-column\"\r\nimport { SearchPanel } from \"./search-panel\";\r\nimport { TaskModal } from \"./task-modal\";\r\nimport { useKanbanSearchParams, useKanbansQueryKey, useProjectInUrl, useTasksQueryKey, useTasksSearchParams } from \"./util\"\r\n\r\nexport const KanbanScreen = () => {\r\n    useDocumentTitle('看板列表')\r\n    const {data: currentProject} = useProjectInUrl()\r\n    const {data: kanbans, isLoading: KanbanIsLoading} = useKanbans(useKanbanSearchParams())\r\n    //也可寫成 const {data: kanbans = []} = useKanbans()\r\n    const {isLoading: taskIsLoading} = useTasks(useTasksSearchParams())\r\n    const isLoading= taskIsLoading || KanbanIsLoading \r\n\r\n    const onDragEnd = useDragEnd()\r\n     return <DragDropContext onDragEnd={onDragEnd}>\r\n       {/* <DragDropContext onDragEnd={(...params) => {\r\n        console.log(...params)\r\n        }}> */}\r\n        <ScreenContainer>\r\n          <h1> {currentProject?.name}看板</h1>\r\n          <SearchPanel />\r\n          {isLoading? <Spin size={'large'}/> :  (\r\n          <ColumnsContainer>\r\n            <Drop type={'COLUMN'} direction={'horizontal'} droppableId={'kanbun'}> \r\n              <DropChild style={{display:'flex'}}>         \r\n                {kanbans?.map((kanban,index) => (\r\n                  <Drag key={kanban.id} draggableId={'kanban'+kanban.id} index={index} > \r\n                    <KanbanColumn kanban={kanban} key={kanban.id} /> \r\n                  </Drag>))\r\n                }                \r\n              </DropChild>\r\n            </Drop>\r\n            <CreateKanban/>\r\n          </ColumnsContainer>\r\n          )}\r\n          <TaskModal/>   \r\n        </ScreenContainer>\r\n    </DragDropContext>\r\n};\r\n\r\nexport const useDragEnd = () => {\r\n  const {data:kanbans} = useKanbans(useKanbanSearchParams())\r\n  const {mutate: reorderKanban} = useReorderKanban(useKanbansQueryKey())\r\n  const {mutate: reorderTask} = useReorderTask(useTasksQueryKey())\r\n  const {data: allTasks = []} = useTasks(useTasksSearchParams())\r\n  return useCallback(({source,destination,type}:DropResult) => {\r\n     if (!destination) {\r\n       return\r\n     }\r\n     //看板排序\r\n     if (type === 'COLUMN') {\r\n      const fromId = kanbans?.[source.index].id\r\n      const toId = kanbans?.[destination.index].id\r\n      if (!fromId || ! toId || fromId === toId) {\r\n        return\r\n      }\r\n      const type = destination.index > source.index? 'after' : 'before'\r\n      reorderKanban({fromId, referenceId: toId, type})\r\n     }\r\n\r\n     if (type === 'ROW') {\r\n       const fromKanbanId = +source.droppableId\r\n       const toKanbanId = +destination.droppableId\r\n       if (fromKanbanId === toKanbanId) {\r\n         return\r\n       }\r\n       const fromTask = allTasks.filter(task => task.kanbanId === fromKanbanId )[source.index]\r\n       const toTask = allTasks.filter(task => task.kanbanId === toKanbanId )[destination.index]\r\n       if (fromTask?.id === toTask?.id) {\r\n         return\r\n       }\r\n       reorderTask({\r\n         fromId: fromTask?.id,\r\n         referenceId: toTask?.id, \r\n         fromKanbanId,\r\n         toKanbanId,\r\n         type: fromKanbanId === toKanbanId && destination.index > source.index ? 'after' : 'before'\r\n          })\r\n     }\r\n  },[kanbans,reorderKanban,allTasks,reorderTask])\r\n}\r\n\r\nexport const ColumnsContainer = styled('div')`\r\n  display: flex;\r\n  overflow-x: scroll;\r\n  flex: 1;\r\n`;","import { useProjectIdInUrl } from \"screens/kanban/util\"\r\n\r\nexport const useEpicSearchParams = () => ({projectId: useProjectIdInUrl()})\r\n\r\nexport const useEpicsQueryKey = () => ['epics', useEpicSearchParams()]","import styled from \"@emotion/styled\"\r\nimport { Button, Drawer, DrawerProps, Form, Input, Spin } from \"antd\"\r\nimport { useForm } from \"antd/lib/form/Form\"\r\nimport { ErrorBox } from \"components/lib\"\r\nimport { useEffect } from \"react\"\r\nimport { useProjectIdInUrl } from \"screens/kanban/util\"\r\nimport { useAddEpic } from \"utils/epic\"\r\nimport { useEpicsQueryKey } from \"./util\"\r\n\r\nexport const CreateEpic = (props: Pick<DrawerProps,'visible'> & {onClose: () => void}) => {\r\n    const {mutate: addEpic, isLoading, error} = useAddEpic(useEpicsQueryKey())\r\n    const  [form] = useForm()\r\n    const projectId = useProjectIdInUrl()\r\n    const onFinish = async (values:any) => {\r\n       await addEpic({...values,projectId})\r\n       props.onClose()\r\n    }\r\n\r\n    useEffect(() => {\r\n        form.resetFields()\r\n    },[form,props.visible])\r\n\r\n    return <Drawer visible={props.visible} \r\n                   onClose={props.onClose} \r\n                   forceRender={true} \r\n                   destroyOnClose={true} \r\n                   width={'100%'}>\r\n       <Container>\r\n       {\r\n            isLoading? <Spin size={\"large\"} /> : <>\r\n            <h1>創建任務組</h1>\r\n            <ErrorBox error={error}/>\r\n            <Form form={form} layout={'vertical'} style={{width:'40rem'}} onFinish={onFinish}>\r\n               <Form.Item label={'名稱'} name={'name'} rules={[{required: true, message: '請輸入任務組名稱'}]} >\r\n                    <Input placeholder={'請輸入任務組名稱'}/>   \r\n               </Form.Item>\r\n               <Form.Item style={{textAlign: \"right\"}}>\r\n                    <Button loading={isLoading} type={'primary'} htmlType={'submit'} >\r\n                      提交\r\n                    </Button>\r\n               </Form.Item>                \r\n            </Form>\r\n            </>\r\n        }\r\n       </Container>\r\n    </Drawer>\r\n}\r\n\r\nconst Container = styled.div`\r\n height: 80vh;\r\n display: flex;\r\n flex-direction: column;\r\n jstify-ontent: center;\r\n align-items: center;\r\n`","import { QueryKey, useMutation, useQuery } from \"react-query\";\r\nimport { Epic } from \"types/epic\";\r\nimport { useHttp } from \"./http\";\r\nimport { useAddConfig, useDeleteConfig } from \"./use-optimistic-options\";\r\n\r\nexport const useEpics = (param?: Partial<Epic>) => {\r\n    const client = useHttp();\r\n    return useQuery<Epic[]>(['epics', param],() => client(\"epics\", {data: param}))\r\n    //改成tuple,字串'epics'固定不會變,但param會變,只要改變就去執行useQuery去server端取資料\r\n  }\r\n\r\nexport const useAddEpic = (queryKey: QueryKey) => {\r\n    const client = useHttp();\r\n   // const queryClient = useQueryClient();\r\n    return useMutation(\r\n      (params: Partial<Epic>) => client(`epics` , {\r\n        method: 'POST',\r\n        data: params\r\n       }),\r\n        useAddConfig(queryKey)\r\n      //{\r\n      //   onSuccess: () => queryClient.invalidateQueries('projects')\r\n      // }\r\n    )\r\n};\r\n\r\nexport const useDeleteEpic = (queryKey: QueryKey) => {\r\n  const client = useHttp();\r\n  return useMutation(\r\n    ({id}:{id:number}) => client(`epics/${id}` , {\r\n      method: 'DELETE'\r\n     }),\r\n      useDeleteConfig(queryKey)\r\n  )\r\n};\r\n\r\n\r\n","import { Button, List, Modal } from \"antd\"\r\nimport { Row, ScreenContainer } from \"components/lib\"\r\nimport dayjs from \"dayjs\"\r\nimport { useState } from \"react\"\r\nimport { Link } from \"react-router-dom\"\r\nimport { useProjectInUrl } from \"screens/kanban/util\"\r\nimport { Epic } from \"types/epic\"\r\nimport { useDeleteEpic, useEpics } from \"utils/epic\"\r\nimport { useTasks } from \"utils/task\"\r\nimport { CreateEpic } from \"./create-epic\"\r\nimport { useEpicSearchParams, useEpicsQueryKey } from \"./util\"\r\n\r\nexport const EpicScreen = () => {\r\n  const {data: currentProject} = useProjectInUrl()\r\n  const {data: epics} = useEpics(useEpicSearchParams())\r\n  const {data: tasks} = useTasks({projectId: currentProject?.id})\r\n  const {mutate: deleteEpic} = useDeleteEpic(useEpicsQueryKey())\r\n  const [createEpicOpen,setCreateEpicOpen] = useState(false)\r\n  const confirmDeleteEpic = (epic: Epic) => {\r\n        Modal.confirm({\r\n          title: `确定删除项目组：${epic.name}`,\r\n          content: \"点击确定删除\",\r\n          okText: \"确定\",\r\n          onOk() {\r\n            deleteEpic({ id: epic.id });\r\n          },\r\n        });\r\n      };\r\n\r\n  return  <ScreenContainer>\r\n          <Row  between={true}>\r\n            <h1> {currentProject?.name}任務組</h1>\r\n            <Button onClick={() => setCreateEpicOpen(true)} type={\"link\"}>創建任務組</Button>\r\n          </Row>  \r\n            <List style={{overflow:'scroll'}} dataSource={epics} itemLayout={\"vertical\"} renderItem={epic => <List.Item>\r\n              <List.Item.Meta\r\n                title={<Row between={true}> \r\n                        <span>{epic.name}</span>\r\n                        <Button onClick={() => confirmDeleteEpic(epic)} type={\"link\"}>删除</Button>\r\n                </Row>}\r\n              description = {<div>\r\n              <div>開始時間: {dayjs(epic.start).format('YYYY-MM-DD')}</div>\r\n              <div>結束時間: {dayjs(epic.end).format('YYYY-MM-DD')}</div>\r\n            </div>}\r\n            />\r\n            <div>\r\n              {tasks?.filter((task) => task.epicId === epic.id).map((task) => (\r\n               <Link to={`/projects/${currentProject?.id}/kanban?editingTaskId=${task.id}`} key={task.id}>{task.name}</Link> ))}\r\n            </div>\r\n            </List.Item>}/> \r\n            <CreateEpic onClose={() => setCreateEpicOpen(false)} visible={createEpicOpen}/>\r\n          </ScreenContainer>\r\n \r\n}\r\n\r\n\r\n","import { Link } from \"react-router-dom\"\r\nimport {Route, Routes, Navigate, useLocation} from \"react-router\"\r\nimport { KanbanScreen } from \"screens/kanban\"\r\nimport { EpicScreen } from \"screens/epic\"\r\nimport styled from \"@emotion/styled\"\r\nimport { Menu } from \"antd\"\r\n\r\nconst useRouteType = () => {\r\n  const units = useLocation().pathname.split('/')\r\n  return units[units.length-1]  \r\n}\r\n\r\nexport const ProjectScreen = () => {\r\n    const routeType = useRouteType()\r\n    return  <Container>\r\n        {/* <h1>ProjectScreen</h1> */}\r\n        {/* <Link to={'/kanban'} >有加/kanban會跑到根路由</Link> */}\r\n        <Aside>\r\n            <Menu mode={\"inline\"} selectedKeys={[routeType]}>\r\n              <Menu.Item key={'kanban'}>\r\n                  <Link to={'kanban'} >看板</Link>                  \r\n              </Menu.Item>\r\n              <Menu.Item key={'epic'}>\r\n              <Link to={'epic'} >任務組</Link>\r\n              </Menu.Item>\r\n            </Menu>\r\n        </Aside>\r\n        <Main>\r\n          <Routes>\r\n            <Route path={'/kanban'} element={<KanbanScreen/>}/>\r\n            <Route path={'/epic'} element={<EpicScreen/>}/>\r\n            <Navigate to={window.location.pathname+'/kanban'} replace={true}/>\r\n          </Routes>\r\n        </Main>\r\n    </Container>\r\n    \r\n}\r\n\r\nconst Aside = styled.aside`\r\n  background-color: rgb(244, 245, 247);\r\n  display: flex;\r\n`;\r\n\r\nconst Main = styled.div`\r\n  box-shadow: -5px 0 5px -5px rgba(0, 0, 0, 0.1);\r\n  display: flex;\r\n  overflow: hidden;\r\n`;\r\n\r\nconst Container = styled.div`\r\n  display: grid;\r\n  grid-template-columns: 16rem 1fr;\r\n  overflow: hidden;\r\n  width: 100%\r\n`;\r\n","import styled from \"@emotion/styled\"\r\nimport { Button, Drawer, Form, Input, Spin } from \"antd\"\r\nimport { useForm } from \"antd/lib/form/Form\"\r\nimport { ErrorBox } from \"components/lib\"\r\nimport { UserSelect } from \"components/user-select\"\r\nimport { useEffect } from \"react\"\r\nimport { useAddProject, useEditProject } from \"utils/project\"\r\n\r\n\r\nimport { useProjectModal, useProjectQueryKey } from \"./util\"\r\n\r\n//export const ProjectModal = (props:{projectModalOpen: boolean, onClose:() => void}) => {\r\nexport const ProjectModal = () => {\r\n    const {projectModalOpen, close, editingProject, isLoading} = useProjectModal()\r\n    const useMutateProject = editingProject? useEditProject : useAddProject\r\n\r\n    const {mutateAsync, error, isLoading: mutateLoading} = useMutateProject(useProjectQueryKey())    \r\n    const [form] = useForm()\r\n    const onFinish = (values:any) => {\r\n        mutateAsync({...editingProject, ...values}).then(() => {\r\n            form.resetFields()\r\n            close()\r\n        })\r\n      \r\n    }\r\n    \r\n    const closeModal = () => {\r\n        form.resetFields()\r\n        close()\r\n    }\r\n    const title = editingProject ? '編輯項目' : '創建項目'\r\n\r\n    useEffect(() => {\r\n        form.setFieldsValue(editingProject)\r\n    },[editingProject, form])\r\n\r\n    // return <Drawer onClose={props.onClose} visible={props.projectModalOpen} width={'100%'}></Drawer>\r\n    return <Drawer \r\n             forceRender={true} \r\n            //  onClose={close} \r\n             onClose={closeModal}\r\n             visible={projectModalOpen} \r\n             width={'100%'}\r\n           >\r\n        <Container>\r\n        {\r\n            isLoading? <Spin size={\"large\"} /> : <>\r\n            <h1>{title}</h1>\r\n            <ErrorBox error={error}/>\r\n            <Form form={form} layout={'vertical'} style={{width:'40rem'}} onFinish={onFinish}>\r\n               <Form.Item label={'名稱'} name={'name'} rules={[{required: true, message: '請輸入項目名稱'}]} >\r\n                    <Input placeholder={'請輸入項目名稱'}/>   \r\n               </Form.Item>\r\n               <Form.Item label={'部門'} name={'organization'} rules={[{required: true, message: '請輸入部門名'}]} >\r\n                    <Input placeholder={'請輸入部門名'}/>   \r\n               </Form.Item> \r\n               <Form.Item label={'負責人'} name={'personId'} >\r\n                    <UserSelect defaultOptionName={'負責人'}  /> \r\n               </Form.Item> \r\n               <Form.Item style={{textAlign: \"right\"}}>\r\n                    <Button loading={mutateLoading} type={'primary'} htmlType={'submit'} >\r\n                      提交\r\n                    </Button>\r\n               </Form.Item>                \r\n            </Form>\r\n\r\n            </>\r\n        }\r\n        {/* <h1>Project Modal</h1>\r\n        <Button onClick={close}>關閉</Button> */}\r\n        </Container>\r\n    </Drawer>\r\n}\r\n\r\nconst Container = styled.div`\r\n height: 80vh;\r\n display: flex;\r\n flex-direction: column;\r\n jstify-ontent: center;\r\n align-items: center;\r\n`","import styled from \"@emotion/styled\"\r\nimport { Divider, List, Popover, Typography } from \"antd\"\r\nimport { useProjectModal } from \"screens/project-list/util\";\r\nimport { useProjects } from \"utils/project\"\r\nimport { ButtonNoPadding } from \"./lib\";\r\n                             \r\n                              //props:{setProjectModalOpen: (isOpen: boolean) => void}\r\n//export const ProjectPopover = (props:{projectButton: JSX.Element}) => {\r\nexport const ProjectPopover = () => {\r\n    const {open} = useProjectModal()\r\n    const {data: projects, refetch} = useProjects();\r\n    const pinnedProjects = projects?.filter((project) => project.pin)\r\n    const content = <ContentContainer>\r\n        <Typography.Text type={\"secondary\"}>收藏項目</Typography.Text>\r\n        <List>\r\n           {pinnedProjects?.map(project => \r\n           <List.Item key={project.id}>\r\n               <List.Item.Meta title={project.name}/>\r\n           </List.Item>) }\r\n        </List>\r\n        <Divider/>\r\n        <ButtonNoPadding \r\n        //    onClick={() => props.setProjectModalOpen(true)}\r\n           onClick={open} \r\n           type={\"link\"}>\r\n              創建項目\r\n        </ButtonNoPadding>\r\n        {/* {props.projectButton} */}\r\n    </ContentContainer>\r\n    return <Popover onVisibleChange={() => refetch()} placement={\"bottom\"} content={content}>\r\n        <span>\r\n         項目\r\n        </span>\r\n    </Popover>\r\n}\r\n\r\nconst ContentContainer = styled.div`\r\n    min-width: 30rem;\r\n`","import styled from \"@emotion/styled\"\r\nimport { Divider, List, Popover, Typography } from \"antd\"\r\nimport { useUsers } from \"utils/user\";\r\n\r\n                             \r\n                              //props:{setProjectModalOpen: (isOpen: boolean) => void}\r\n//export const ProjectPopover = (props:{projectButton: JSX.Element}) => {\r\nexport const UserPopover = () => {\r\n    const {data: users, refetch} = useUsers();\r\n  \r\n    const content = <ContentContainer>\r\n        <Typography.Text type={\"secondary\"}>組員列表</Typography.Text>\r\n        <List>\r\n           {users?.map((user) => \r\n           <List.Item key={user.id}>\r\n               <List.Item.Meta title={user.name}/>\r\n           </List.Item>)}\r\n        </List>\r\n        <Divider/>\r\n        {/* <ButtonNoPadding \r\n        //    onClick={() => props.setProjectModalOpen(true)}\r\n           onClick={open} \r\n           type={\"link\"}>\r\n              創建項目\r\n        </ButtonNoPadding> */}\r\n        {/* {props.projectButton} */}\r\n    </ContentContainer>\r\n    return <Popover onVisibleChange={() => refetch()} placement={\"bottom\"} content={content}>\r\n        <span>\r\n         組員\r\n        </span>\r\n    </Popover>\r\n}\r\n\r\nconst ContentContainer = styled.div`\r\n    min-width: 30rem;\r\n`","import { useAuth } from \"context/auth-context\";\r\nimport { ProjectListScreen } from \"screens/project-list\";\r\nimport { ProjectScreen } from \"screens/project\";\r\nimport styled from \"@emotion/styled\";\r\nimport { ButtonNoPadding, Row } from \"components/lib\";\r\nimport { ReactComponent as Softwarelogo}  from 'assets/software-logo.svg';\r\nimport { Button, Dropdown, Menu } from \"antd\";\r\nimport { Route, Routes, Navigate} from 'react-router';\r\nimport {BrowserRouter as Router} from 'react-router-dom'\r\nimport { resetRoute } from \"utils\";\r\n//import { useState } from \"react\";\r\nimport { ProjectModal } from \"screens/project-list/project-modal\";\r\nimport { ProjectPopover } from \"components/project-popover\";\r\nimport { UserPopover } from \"components/user-popover\";\r\n/**\r\n * grid 和 flex 各自的应用场景\r\n * 1. 要考虑，是一维布局 还是 二维布局\r\n * 一般来说，一维布局用flex，二维布局用grid\r\n * 2. 是从内容出发还是从布局出发？\r\n * 从内容出发：你先有一组内容(数量一般不固定),然后希望他们均匀的分布在容器中，由内容自己的大小决定占据的空间\r\n * 从布局出发：先规划网格(数量一般比较固定)，然后再把元素往里填充\r\n * 从内容出发，用flex\r\n * 从布局出发，用grid\r\n *\r\n */\r\n\r\n//10-3 10:00 prop drilling(下鑽) 沒有解耦合\r\nexport const AuthenticatedApp = () => {\r\n   //  const [projectModalOpen, setProjectModalOpen] = useState(false)\r\n    // const value: any = undefined  //\r\n    return (\r\n        <Container>\r\n          <Router>\r\n          {/* {value.notExist} */}\r\n\r\n          {/* <PageHader  setProjectModalOpen = {setProjectModalOpen}/> */}\r\n          {/* <PageHader projectButton = {\r\n            <ButtonNoPadding \r\n            onClick={() => setProjectModalOpen(true)} \r\n            type={\"link\"}>\r\n                創建項目\r\n          </ButtonNoPadding>\r\n          } /> */}\r\n          <PageHader/>\r\n\r\n          {/* <Button onClick={() => setProjectModalOpen(true)}>打開</Button> */}\r\n          <Main>\r\n                       \r\n              <Routes>\r\n                {/* 可看utils/project.ts 內的 run(client(\"projects\".... */}\r\n                {/* <Route path={'/projects'} element={<ProjectListScreen setProjectModalOpen = {setProjectModalOpen}/>}/> */}\r\n                 {/* <Route path={'/projects'} element={<ProjectListScreen projectButton = {\r\n                                                                        <ButtonNoPadding \r\n                                                                           onClick={() => setProjectModalOpen(true)} \r\n                                                                           type={\"link\"}>\r\n                                                                             創建項目\r\n                                                                        </ButtonNoPadding>\r\n                                                                        }/>}/> */}\r\n                 <Route path={'/projects'} element={<ProjectListScreen />}/>\r\n                 <Route path={'/projects/:projectId/*'} element={<ProjectScreen />}/>\r\n                 <Navigate to={'/projects'}/>\r\n              </Routes>\r\n            \r\n          </Main>\r\n          {/* <ProjectModal projectModalOpen={projectModalOpen} onClose={() => setProjectModalOpen(false)} /> */}\r\n          <ProjectModal />\r\n          </Router> \r\n        </Container>\r\n      );\r\n    // return <div>\r\n    //     <button onClick={logout}>登出</button>\r\n    //     <ProjectListScreen />\r\n    // </div>\r\n}\r\n\r\n                   //props:{setProjectModalOpen: (isOpen: boolean) => void}\r\n// const PageHader = (props:{projectButton: JSX.Element}) => {\r\nconst PageHader = () => {\r\n  \r\n    return <Header between={true}>\r\n    <HeaderLeft gap={true}>\r\n      {/* <img src={Softwarelogo} alt=\"找不到圖片\"/> */}\r\n      <ButtonNoPadding type={'link'} onClick={resetRoute} >\r\n        <Softwarelogo width={\"18rem\"} color={\"rgb(38, 132, 255)\"}></Softwarelogo>\r\n      </ButtonNoPadding>      \r\n      {/* <h2>项目</h2> */}\r\n      {/* <ProjectPopover setProjectModalOpen={props.setProjectModalOpen} /> */}\r\n      {/* <ProjectPopover {...props} /> */}\r\n      <ProjectPopover/>\r\n      <UserPopover/>\r\n      {/* <span>用户</span> */}\r\n    </HeaderLeft>\r\n    <HeaderRight>\r\n      {/* <button onClick={logout}>登出</button> */}\r\n      <User/>\r\n      \r\n    </HeaderRight>\r\n  </Header>\r\n}\r\n\r\n// const HeaderItem = styled.h3`\r\n//   margin-right: 3rem;\r\n// `;\r\n\r\n//var 有變量提昇,let和const 沒有看10-2 2:00 temporal dead zone 暫時性死區\r\nconst User = () => {\r\n const {logout, user} = useAuth()\r\n return <Dropdown\r\n       overlay={\r\n        <Menu>\r\n          <Menu.Item key={\"logout\"}>\r\n          <Button onClick={logout} type={\"link\"}>登出</Button>\r\n            {/* <a onClick={logout} href=\"/#\">登出</a> */}\r\n          </Menu.Item>\r\n        </Menu>\r\n      }>\r\n        <Button type={\"link\"} onClick={(e) => e.preventDefault()}>Hi, {user?.name}</Button>\r\n       {/* <a onClick={(e) => e.preventDefault()} href=\"/#\" >Hi, {user?.name}</a> */}\r\n       {/* < e.preventDefault() 防止頁面刷新> */}            \r\n      </Dropdown>\r\n}\r\n\r\nconst Container = styled.div`\r\n  display: grid;\r\n  grid-template-rows: 6rem 1fr 6rem;\r\n  height: 100vh;\r\n`;\r\n\r\n// grid-area 用来给grid子元素起名字\r\nconst Header = styled(Row)`\r\npadding: 3.2rem;\r\nbox-shadow: 0 0 5px 0 rgba(0, 0, 0, 0.1);\r\nz-index: 1;\r\n`;\r\nconst HeaderLeft = styled(Row)``;\r\nconst HeaderRight = styled.div``;\r\n\r\nconst Main = styled.main`\r\ndisplay: flex;\r\noverflow: hidden;\r\n`\r\n","import { useAuth } from \"context/auth-context\";\r\nimport { Form, Input } from \"antd\";\r\nimport { LongButton } from \"unauthenticated-app\";\r\nimport { useAsync } from \"utils/use-async\";\r\n// import { FormEvent } from \"react\";\r\n// import { login } from \"auth-provider\";\r\n// import { clearnObject } from \"utils\";\r\n\r\n// interface Base {\r\n//   id: number\r\n// }\r\n//\r\n// interface Advance extends Base {\r\n//   name: string\r\n// }\r\n//\r\n// const test = (p: Base) => {\r\n// }\r\n//\r\n// // 鸭子类型(duck typing)：面向接口编程 而不是 面向对象编程,只要接口符合即可,\r\n// // 但在java中是不允許的\r\n// const a = {id: 1, name: 'jack'}\r\n// test(a)\r\n\r\n\r\nexport const LoginScreen = ({onError}: {onError: (error: Error) => void }) => {\r\n  const {login} = useAuth();\r\n  const {run, isLoading } = useAsync(undefined, {throwOnError: true});\r\n  // const login = (param: {username: string; password: string }) => {    \r\n  // };\r\n\r\n  // HTMLFormElement extends Element\r\n  // const handleSubmit = (event: FormEvent<HTMLFormElement> ) => {\r\n  //   event.preventDefault();\r\n  //   const username = (event.currentTarget.elements[0] as HTMLInputElement).value;\r\n  //   const password = (event.currentTarget.elements[1] as HTMLInputElement).value;\r\n  //   login({ username, password });\r\n  // };\r\n\r\n  const handleSubmit = async (values: { username: string; password: string }) => {\r\n    try {\r\n    // await login(values); \r\n    await  run(login(values));       \r\n   } catch (e) {\r\n     onError(e);\r\n   }\r\n   //若使用 login(values).catch((e) => onError(e)) 不使用try catch 則不須使用async await,\r\n   //因為 catch是在login(values)之後才發生,\r\n   //使用try catch 則須使用async await,因為執行try{login(values)} 還沒執行完(因為去server取資料) ,就會往下執行catch(e) {onError(e)}\r\n  };\r\n\r\n  return (\r\n    <Form onFinish={handleSubmit}>\r\n      <Form.Item name={'username'} rules={[{ required: true, message: \"请输入用戶名\" }]}>\r\n        {/* <label htmlFor=\"username\">用户名</label> */}\r\n        <Input placeholder={'用户名'} type=\"text\" id={\"username\"} />\r\n      </Form.Item>\r\n      <Form.Item name={'password'} rules={[{ required: true, message: \"请输入密码\" }]}>\r\n        {/* <label htmlFor=\"password\">密码</label> */}\r\n        <Input placeholder={'密码'} type=\"password\" id={\"password\"} />\r\n        {/* <input type=\"password\" id={\"password\"} /> */}\r\n      </Form.Item>\r\n      <LongButton loading={isLoading} htmlType={\"submit\"} type={\"primary\"}>登入</LongButton>\r\n    </Form>\r\n  );\r\n};","import { useAuth } from \"context/auth-context\";\r\nimport {  Form, Input } from \"antd\";\r\nimport { LongButton } from \"unauthenticated-app\";\r\nimport { useAsync } from \"utils/use-async\";\r\n\r\nexport const RegisterScreen =  ({onError}: {onError: (error: Error) => void}) => {\r\n  const {run, isLoading } = useAsync(undefined, {throwOnError: true});\r\n  const {register} = useAuth();\r\n  //{cpassword, ...values} 是表示解構後有{cpassword,username,password},但不想破壞values代表{username,password}\r\n  //因為values會傳去server交互,不須傳cpassword\r\n  const handleSubmit = async ({cpassword, ...values}: { username: string; password: string; cpassword: string }) => {\r\n    try {\r\n      if (cpassword !== values.password) {\r\n        onError(new Error('請確認兩次輸入內容相同'))\r\n        return\r\n      }\r\n      await  run(register(values));  \r\n     // await register(values);\r\n    } catch (e) {\r\n      onError(e);\r\n    }    \r\n  };\r\n\r\n  return (\r\n    <Form onFinish={handleSubmit}>\r\n      <Form.Item name={'username'} rules={[{ required: true, message: \"请输入用戶名\" }]}>\r\n        {/* <label htmlFor=\"username\">用户名</label> */}\r\n        <Input placeholder={'用户名'} type=\"text\" id={\"username\"} />\r\n      </Form.Item>\r\n      <Form.Item name={'password'} rules={[{ required: true, message: \"请输入密码\" }]}>\r\n        {/* <label htmlFor=\"password\">密码</label> */}\r\n        <Input placeholder={'密码'} type=\"password\" id={\"password\"} />\r\n        {/* <input type=\"password\" id={\"password\"} /> */}\r\n      </Form.Item>\r\n      <Form.Item name={'cpassword'} rules={[{ required: true, message: \"请確認密码\" }]}>\r\n        <Input placeholder={'確認密码'} type=\"password\" id={\"cpassword\"} />\r\n      </Form.Item>\r\n      <LongButton loading={isLoading} htmlType={\"submit\"} type={\"primary\"}>註冊</LongButton>\r\n    </Form>\r\n  );\r\n};","export default __webpack_public_path__ + \"static/media/logo.6c866125.svg\";","export default __webpack_public_path__ + \"static/media/left.e74de3ec.svg\";","export default __webpack_public_path__ + \"static/media/right.b423a6cf.svg\";","import { Button, Card, Divider } from \"antd\";\r\nimport { useState } from \"react\";\r\nimport { LoginScreen } from \"./login\";\r\nimport { RegisterScreen } from \"./register\";\r\nimport styled from \"@emotion/styled\";\r\nimport logo from \"assets/logo.svg\";\r\nimport left from \"assets/left.svg\";\r\nimport right from \"assets/right.svg\";\r\nimport { useDocumentTitle } from \"utils\";\r\nimport { ErrorBox } from \"components/lib\";\r\n//import {Helmet} from \"react-helmet\";\r\n\r\nexport const UnauthenticatedApp = () => {\r\n    const [isRegister, setIsRegister] = useState(false);\r\n    const [error, setError] = useState<Error | null>(null);\r\n    useDocumentTitle('請登入或註冊');\r\n\r\n    return (\r\n    <Container>\r\n    {/* return <div style={{display:'flex', justifyContent:'center'}}> */}\r\n    {/* <Helmet>\r\n      <title>請登入或註冊</title>\r\n    </Helmet> */}\r\n     <Header/>\r\n     <Background />\r\n       {/* <Button  onClick={() => {\r\n         throw new Error('點擊拋出異常')\r\n       }}>拋出異常</Button> */}\r\n        <ShadowCard>\r\n          <Title>{isRegister ? \"請註冊\" : \"請登入\"}</Title>\r\n          <ErrorBox error={error} />\r\n          {/* {error? <Typography.Text type={\"danger\"}>{error.message}</Typography.Text> : null } */}\r\n          {isRegister?  <RegisterScreen onError={setError}/> : <LoginScreen onError={setError}/>}\r\n          <Divider/>\r\n          <Button type={\"link\"} onClick={() => setIsRegister(!isRegister)}>\r\n           {isRegister ? \"已經有帳號?直接登入\" : \"沒有帳號?註冊新帳號\"}\r\n-         </Button>\r\n           {/* <a href=\"/#\" onClick={() => setIsRegister(!isRegister)}>\r\n           {isRegister? '已經有帳號?直接登入' : '沒有帳號?註冊新帳號' }</a> */}\r\n        </ShadowCard>\r\n        \r\n    </Container> \r\n)\r\n};\r\n\r\nexport const LongButton = styled(Button)`\r\n  width: 100%;\r\n`\r\n\r\nconst Title = styled.h2`\r\n  margin-bottom: 2.4rem;\r\n  color: rgb(94, 108, 132);\r\n`;\r\n\r\nconst Background = styled.div`\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  background-repeat: no-repeat;\r\n  background-attachment: fixed;\r\n  background-position: left bottom, right bottom;\r\n  background-size: calc(((100vw - 40rem) / 2) - 3.2rem),\r\n    calc(((100vw - 40rem) / 2) - 3.2rem), cover;\r\n  background-image: url(${left}), url(${right});\r\n`;\r\n\r\nconst Header = styled.header`\r\n  background: url(${logo}) no-repeat center;\r\n  padding: 5rem 0;\r\n  background-size: 8rem;\r\n  width: 100%;\r\n`;\r\n\r\nconst ShadowCard = styled(Card)`\r\n  width: 40rem;\r\n  min-height: 56rem;\r\n  padding: 3.2rem 4rem;\r\n  border-radius: 0.3rem;\r\n  box-sizing: border-box;\r\n  box-shadow: rgba(0, 0, 0, 0.1) 0 0 10px;\r\n  text-align: center;\r\n`\r\n\r\nconst Container = styled.div `\r\ndisplay: flex;\r\nflex-direction: column;\r\nalign-items: center;\r\nmin-height: 100vh;\r\n`","import { Component, PropsWithChildren, ReactElement } from \"react\";\r\n\r\ntype FallbackRender = (props: {error:Error | null}) => ReactElement\r\n\r\n//https://github.com/bvaughn/react-error-boundary\r\n// export class ErrorBoundary extends Component<{children:ReactNode, fallbackRender: FallbackRender}, any> {\r\nexport class ErrorBoundary extends Component<PropsWithChildren<{fallbackRender: FallbackRender}>, {error:Error | null}> {\r\n    state = {error: null}\r\n    \r\n    //當子組件拋出異常,這裡會接受到並且調用\r\n    static getDerivedStateFromError(error: Error) {\r\n        return {error}\r\n    }\r\n\r\n    render() {\r\n       const {error} = this.state \r\n       const {fallbackRender,children} = this.props\r\n       if (error) {\r\n         return fallbackRender({error})\r\n       }\r\n       return children\r\n    }\r\n}","import './App.css';\r\nimport { useAuth } from 'context/auth-context';\r\nimport { AuthenticatedApp } from 'authenticated-app';\r\nimport { UnauthenticatedApp } from 'unauthenticated-app';\r\nimport { ErrorBoundary } from 'components/error-boundary';\r\nimport { FullyPageErrorFallBack } from 'components/lib';\r\n// import {ProjectListScreen} from './screens/project-list';\r\n// import { TsReactTest } from \"try-use-array\";\r\n// import { LoginScreen } from \"screens/login\";\r\n\r\n\r\nfunction App() {\r\n \r\n  const {user} = useAuth();\r\n\r\n  return (\r\n    <div className=\"App\">\r\n        <ErrorBoundary fallbackRender={FullyPageErrorFallBack}>\r\n          {user? <AuthenticatedApp/> : <UnauthenticatedApp/>}\r\n        </ErrorBoundary>\r\n          {/* <LoginScreen /> */}\r\n          {/* <ProjectListScreen/> */}\r\n          {/* <TsReactTest /> */}\r\n        \r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import { ReactNode } from \"react\";\r\nimport { QueryClient, QueryClientProvider } from \"react-query\";\r\nimport { AuthProvider } from \"./auth-context\";\r\n\r\nexport const AppProviders = ({children}:{children:ReactNode}) => {\r\n return  <QueryClientProvider client={new QueryClient()}>\r\n    <AuthProvider>\r\n       {/*  children 可看成從 <AppProviders> 下帶入的 <DevTools /> */}\r\n       {children} \r\n    </AuthProvider>\r\n </QueryClientProvider>\r\n\r\n\r\n};","import './wdyr';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport {DevTools, loadServer} from 'jira-dev-tool';\r\n// import {loadDevTools} from 'jira-dev-tool';\r\n//務必在jira-dev-tool後面引入\r\nimport 'antd/dist/antd.less';\r\nimport { AppProviders } from 'context';\r\n// import './index.css';\r\n\r\n// loadDevTools(() =>\r\nloadServer(() =>\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    {/* <DevTools />  可看成 <AppProviders> 下帶入的 children */}\r\n    <AppProviders> \r\n    <DevTools />\r\n      <App />\r\n    </AppProviders>    \r\n  </React.StrictMode>,\r\n  document.getElementById(\"root\")\r\n))\r\n\r\n//\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}